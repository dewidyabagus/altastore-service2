
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>common: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">AltaStore/api/common/error_business_response.go (0.0%)</option>
				
				<option value="file1">AltaStore/api/common/error_controller_response.go (0.0%)</option>
				
				<option value="file2">AltaStore/api/common/success_response.go (0.0%)</option>
				
				<option value="file3">AltaStore/api/middleware/jwt.go (18.2%)</option>
				
				<option value="file4">AltaStore/api/middleware/logger.go (0.0%)</option>
				
				<option value="file5">AltaStore/api/routes.go (0.0%)</option>
				
				<option value="file6">AltaStore/api/v1/admin/controller.go (0.0%)</option>
				
				<option value="file7">AltaStore/api/v1/admin/request/insert.go (0.0%)</option>
				
				<option value="file8">AltaStore/api/v1/admin/request/update_admin.go (0.0%)</option>
				
				<option value="file9">AltaStore/api/v1/admin/request/update_admin_password.go (0.0%)</option>
				
				<option value="file10">AltaStore/api/v1/admin/response/get_admin.go (0.0%)</option>
				
				<option value="file11">AltaStore/api/v1/adminauth/controller.go (0.0%)</option>
				
				<option value="file12">AltaStore/api/v1/adminauth/response/login.go (0.0%)</option>
				
				<option value="file13">AltaStore/api/v1/category/controller.go (0.0%)</option>
				
				<option value="file14">AltaStore/api/v1/category/request/insert.go (0.0%)</option>
				
				<option value="file15">AltaStore/api/v1/category/request/update.go (0.0%)</option>
				
				<option value="file16">AltaStore/api/v1/category/response/allCategory.go (0.0%)</option>
				
				<option value="file17">AltaStore/api/v1/category/response/oneCategory.go (0.0%)</option>
				
				<option value="file18">AltaStore/api/v1/checkout/controller.go (0.0%)</option>
				
				<option value="file19">AltaStore/api/v1/checkout/request/insertCheckout.go (0.0%)</option>
				
				<option value="file20">AltaStore/api/v1/checkout/response/sumcheckout.go (0.0%)</option>
				
				<option value="file21">AltaStore/api/v1/checkoutpayment/controller.go (0.0%)</option>
				
				<option value="file22">AltaStore/api/v1/checkoutpayment/request/insert.go (0.0%)</option>
				
				<option value="file23">AltaStore/api/v1/product/controller.go (0.0%)</option>
				
				<option value="file24">AltaStore/api/v1/product/request/insert.go (0.0%)</option>
				
				<option value="file25">AltaStore/api/v1/product/request/update.go (0.0%)</option>
				
				<option value="file26">AltaStore/api/v1/product/response/getAll.go (0.0%)</option>
				
				<option value="file27">AltaStore/api/v1/product/response/getById.go (0.0%)</option>
				
				<option value="file28">AltaStore/api/v1/purchasereceiving/controller.go (0.0%)</option>
				
				<option value="file29">AltaStore/api/v1/purchasereceiving/request/insert.go (0.0%)</option>
				
				<option value="file30">AltaStore/api/v1/purchasereceiving/request/update.go (0.0%)</option>
				
				<option value="file31">AltaStore/api/v1/purchasereceiving/response/getAll.go (0.0%)</option>
				
				<option value="file32">AltaStore/api/v1/purchasereceiving/response/getById.go (0.0%)</option>
				
				<option value="file33">AltaStore/api/v1/shopping/controller.go (0.0%)</option>
				
				<option value="file34">AltaStore/api/v1/shopping/response/oneResponse.go (0.0%)</option>
				
				<option value="file35">AltaStore/api/v1/user/controller.go (0.0%)</option>
				
				<option value="file36">AltaStore/api/v1/user/request/insert_user.go (0.0%)</option>
				
				<option value="file37">AltaStore/api/v1/user/request/update_user.go (0.0%)</option>
				
				<option value="file38">AltaStore/api/v1/user/request/update_user_password.go (0.0%)</option>
				
				<option value="file39">AltaStore/api/v1/user/response/get_user.go (0.0%)</option>
				
				<option value="file40">AltaStore/api/v1/userauth/controller.go (0.0%)</option>
				
				<option value="file41">AltaStore/api/v1/userauth/response/login.go (0.0%)</option>
				
				<option value="file42">AltaStore/business/admin/admin.go (100.0%)</option>
				
				<option value="file43">AltaStore/business/admin/mocks/Repository.go (82.5%)</option>
				
				<option value="file44">AltaStore/business/admin/mocks/Service.go (31.6%)</option>
				
				<option value="file45">AltaStore/business/admin/service.go (84.0%)</option>
				
				<option value="file46">AltaStore/business/adminauth/mocks/Service.go (0.0%)</option>
				
				<option value="file47">AltaStore/business/adminauth/service.go (90.9%)</option>
				
				<option value="file48">AltaStore/business/category/category.go (100.0%)</option>
				
				<option value="file49">AltaStore/business/category/mocks/Repository.go (82.4%)</option>
				
				<option value="file50">AltaStore/business/category/mocks/Service.go (0.0%)</option>
				
				<option value="file51">AltaStore/business/category/service.go (100.0%)</option>
				
				<option value="file52">AltaStore/business/checkout/checkout.go (91.7%)</option>
				
				<option value="file53">AltaStore/business/checkout/mocks/RepoShoppingDetail.go (81.8%)</option>
				
				<option value="file54">AltaStore/business/checkout/mocks/Repository.go (82.1%)</option>
				
				<option value="file55">AltaStore/business/checkout/mocks/Service.go (0.0%)</option>
				
				<option value="file56">AltaStore/business/checkout/service.go (100.0%)</option>
				
				<option value="file57">AltaStore/business/checkoutpayment/checkoutpayment.go (100.0%)</option>
				
				<option value="file58">AltaStore/business/checkoutpayment/mocks/Repository.go (81.8%)</option>
				
				<option value="file59">AltaStore/business/checkoutpayment/mocks/Service.go (36.4%)</option>
				
				<option value="file60">AltaStore/business/checkoutpayment/service.go (33.3%)</option>
				
				<option value="file61">AltaStore/business/logger/service.go (0.0%)</option>
				
				<option value="file62">AltaStore/business/product/mocks/Repository.go (82.3%)</option>
				
				<option value="file63">AltaStore/business/product/mocks/Service.go (0.0%)</option>
				
				<option value="file64">AltaStore/business/product/product.go (100.0%)</option>
				
				<option value="file65">AltaStore/business/product/service.go (86.0%)</option>
				
				<option value="file66">AltaStore/business/purchasereceiving/mocks/Repository.go (82.4%)</option>
				
				<option value="file67">AltaStore/business/purchasereceiving/mocks/RepositoryDetail.go (47.5%)</option>
				
				<option value="file68">AltaStore/business/purchasereceiving/mocks/Service.go (0.0%)</option>
				
				<option value="file69">AltaStore/business/purchasereceiving/purchasereceiving.go (83.3%)</option>
				
				<option value="file70">AltaStore/business/purchasereceiving/service.go (65.8%)</option>
				
				<option value="file71">AltaStore/business/shopping/mocks/Repository.go (81.8%)</option>
				
				<option value="file72">AltaStore/business/shopping/mocks/RepositoryCartDetail.go (82.8%)</option>
				
				<option value="file73">AltaStore/business/shopping/mocks/Service.go (0.0%)</option>
				
				<option value="file74">AltaStore/business/shopping/service.go (100.0%)</option>
				
				<option value="file75">AltaStore/business/shopping/shopping.go (90.5%)</option>
				
				<option value="file76">AltaStore/business/user/mocks/Repository.go (82.5%)</option>
				
				<option value="file77">AltaStore/business/user/mocks/Service.go (29.8%)</option>
				
				<option value="file78">AltaStore/business/user/service.go (84.0%)</option>
				
				<option value="file79">AltaStore/business/user/user.go (100.0%)</option>
				
				<option value="file80">AltaStore/business/userauth/mocks/Service.go (0.0%)</option>
				
				<option value="file81">AltaStore/business/userauth/service.go (90.9%)</option>
				
				<option value="file82">AltaStore/config/config.go (79.3%)</option>
				
				<option value="file83">AltaStore/main.go (0.0%)</option>
				
				<option value="file84">AltaStore/modules/admin/repository.go (0.0%)</option>
				
				<option value="file85">AltaStore/modules/category/repository.go (0.0%)</option>
				
				<option value="file86">AltaStore/modules/checkout/repository.go (0.0%)</option>
				
				<option value="file87">AltaStore/modules/checkoutpayment/repository.go (0.0%)</option>
				
				<option value="file88">AltaStore/modules/logger/repository.go (0.0%)</option>
				
				<option value="file89">AltaStore/modules/migration/migration.go (0.0%)</option>
				
				<option value="file90">AltaStore/modules/product/repository.go (0.0%)</option>
				
				<option value="file91">AltaStore/modules/purchasereceiving/repository.go (0.0%)</option>
				
				<option value="file92">AltaStore/modules/purchasereceivingdetail/repository.go (0.0%)</option>
				
				<option value="file93">AltaStore/modules/shopping/repository.go (0.0%)</option>
				
				<option value="file94">AltaStore/modules/shoppingdetail/repository.go (0.0%)</option>
				
				<option value="file95">AltaStore/modules/user/repository.go (0.0%)</option>
				
				<option value="file96">AltaStore/util/validator/validator.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package common

import (
        "AltaStore/business"
        "net/http"
)

const (
        errInternalServerError responseCode = "500"
        errNotFound            responseCode = "404"
        errHasBeenModified     responseCode = "400"
        errNotHavePermission   responseCode = "401"
        errPasswordMisMatch    responseCode = "403"
        errInvalidSpec         responseCode = "400"
        errDataExists          responseCode = "409"
        errUnAuthorized        responseCode = "401"
)

// Mengembalikan respons status dari permintaan
func NewBusinessErrorResponse(err error) (int, ControllerResponse) <span class="cov0" title="0">{
        return errorMapping(err)
}</span>

func errorMapping(err error) (int, ControllerResponse) <span class="cov0" title="0">{
        switch err </span>{
        default:<span class="cov0" title="0">
                return newInternalServerErrorResponse()</span>

        case business.ErrNotFound:<span class="cov0" title="0">
                return newNotFoundResponse()</span>

        case business.ErrHasBeenModified:<span class="cov0" title="0">
                return newHasBeenModifiedResponse()</span>

        case business.ErrNotHavePermission:<span class="cov0" title="0">
                return newNotHavePermission()</span>

        case business.ErrPasswordMisMatch:<span class="cov0" title="0">
                return newErrPasswordMisMatch()</span>

        case business.ErrInvalidSpec:<span class="cov0" title="0">
                return newErrInvalidSpec()</span>

        case business.ErrDataExists:<span class="cov0" title="0">
                return newErrDataExists()</span>

        case business.ErrUnAuthorized:<span class="cov0" title="0">
                return newErrUnAuthorized()</span>
        }
}

func newInternalServerErrorResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusInternalServerError,
                ControllerResponse{errInternalServerError, "Internal Server Error", map[string]interface{}{}}
}</span>

func newNotFoundResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusNotFound,
                ControllerResponse{errNotFound, "Data Not Found", map[string]interface{}{}}
}</span>

func newHasBeenModifiedResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errHasBeenModified, "Data Has Been Modified", map[string]interface{}{}}
}</span>

func newNotHavePermission() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errHasBeenModified, "Not Have Permission", map[string]interface{}{}}
}</span>

func newErrPasswordMisMatch() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errHasBeenModified, "Wrong Password", map[string]interface{}{}}
}</span>

func newErrInvalidSpec() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errInvalidSpec, "Bad Request", map[string]interface{}{}}
}</span>

func newErrDataExists() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errDataExists, "Data Exists", map[string]interface{}{}}
}</span>

func newErrUnAuthorized() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest,
                ControllerResponse{errUnAuthorized, "Unauthorized", map[string]interface{}{}}
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package common

import "net/http"

const (
        BadRequestCode responseCode = "400"
        ForbiddenCode  responseCode = "403"
        NotFoundCode   responseCode = "404"
        UnAuthorized   responseCode = "401"
)

func BadRequestResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusBadRequest, ControllerResponse{BadRequestCode, "Bad Request", map[string]interface{}{}}
}</span>

func ForbiddenResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusForbidden, ControllerResponse{ForbiddenCode, "Forbidden", map[string]interface{}{}}
}</span>

func NotFoundResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusNotFound, ControllerResponse{NotFoundCode, "Not Found", map[string]interface{}{}}
}</span>

func UnAuthorizedResponse() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusNotFound, ControllerResponse{NotFoundCode, "UnAuthorized", map[string]interface{}{}}
}</span>
</pre>
		
		<pre class="file" id="file2" style="display: none">package common

import (
        "net/http"
)

const (
        Success responseCode = "200"
)

func SuccessResponseWithData(data interface{}) (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusOK, ControllerResponse{Success, "success", data}
}</span>

func SuccessResponseWithoutData() (int, ControllerResponse) <span class="cov0" title="0">{
        return http.StatusOK, ControllerResponse{Success, "success", map[string]interface{}{}}
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package middleware

import (
        "AltaStore/config"
        "errors"
        "net/http"

        "github.com/golang-jwt/jwt"
        echo "github.com/labstack/echo/v4"
        "github.com/labstack/echo/v4/middleware"
)

func init() <span class="cov8" title="1">{
        middleware.ErrJWTMissing = echo.NewHTTPError(
                http.StatusBadRequest, map[string]interface{}{
                        "code":    400,
                        "message": "missing or malformed jwt",
                })
        middleware.ErrJWTInvalid = echo.NewHTTPError(
                http.StatusUnauthorized, map[string]interface{}{
                        "code":    401,
                        "massage": "invalid or expired jwt",
                })
}</span>

func JWTMiddleware() echo.MiddlewareFunc <span class="cov0" title="0">{
        return middleware.JWTWithConfig(middleware.JWTConfig{
                SigningMethod: "HS256",
                SigningKey:    []byte(config.GetConfig().JwtSecretKey),
        })
}</span>

func ExtractToken(ctx echo.Context) (string, error) <span class="cov0" title="0">{
        user := ctx.Get("user").(*jwt.Token)
        if user.Valid </span><span class="cov0" title="0">{
                claim := user.Claims.(jwt.MapClaims)
                userId := claim["userId"].(string)
                if userId == "" </span><span class="cov0" title="0">{
                        return "", errors.New("Unauthorize")
                }</span>
                <span class="cov0" title="0">return userId, nil</span>
        }
        <span class="cov0" title="0">return "", errors.New("Unauthorize")</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package middleware

// Logger middleware logs the information about each HTTP request.

import (
        "fmt"
        "net/http"
        "time"

        echo "github.com/labstack/echo/v4"
        log "github.com/sirupsen/logrus"
)

// Penformatan pencatatan sistem
func MakeLogEntry(c echo.Context) *log.Entry <span class="cov0" title="0">{
        start := time.Now()

        if c == nil </span><span class="cov0" title="0">{
                return log.WithFields(log.Fields{
                        "latency_ns": time.Since(start).Nanoseconds(),
                        "group":      "system",
                })
        }</span>

        <span class="cov0" title="0">return log.WithFields(log.Fields{
                "group":      "request",
                "method":     c.Request().Method,
                "uri":        c.Request().RequestURI,
                "remoteaddr": c.Request().RemoteAddr,
                "latency_ns": time.Since(start).Nanoseconds(),
        })</span>
}

func MiddlewareLogger(next echo.HandlerFunc) echo.HandlerFunc <span class="cov0" title="0">{
        return func(c echo.Context) error </span><span class="cov0" title="0">{
                MakeLogEntry(c).Info("Incoming Connection")
                return next(c)
        }</span>
}

func ErrorHandler(err error, c echo.Context) <span class="cov0" title="0">{
        report, ok := err.(*echo.HTTPError)
        if ok </span><span class="cov0" title="0">{
                report.Message = fmt.Sprintf("http error %d - %v", report.Code, report.Message)
        }</span> else<span class="cov0" title="0"> {
                report = echo.NewHTTPError(http.StatusInternalServerError, err.Error())
        }</span>

        <span class="cov0" title="0">MakeLogEntry(c).Error(report.Message)
        c.HTML(report.Code, report.Message.(string))</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package api

import (
        "AltaStore/api/middleware"
        "AltaStore/api/v1/admin"
        "AltaStore/api/v1/adminauth"
        "AltaStore/api/v1/category"
        "AltaStore/api/v1/checkout"
        "AltaStore/api/v1/checkoutpayment"
        "AltaStore/api/v1/product"
        "AltaStore/api/v1/purchasereceiving"
        "AltaStore/api/v1/shopping"
        "AltaStore/api/v1/user"
        "AltaStore/api/v1/userauth"
        "net/http"

        echo "github.com/labstack/echo/v4"
)

func RegisterPath(e *echo.Echo,
        category *category.Controller,
        userController *user.Controller,
        adminController *admin.Controller,
        userAuthController *userauth.Controller,
        adminAuthController *adminauth.Controller,
        productController *product.Controller,
        shopping *shopping.Controller,
        checkout *checkout.Controller,
        purchaseController *purchasereceiving.Controller,
        paymentController *checkoutpayment.Controller,
) <span class="cov0" title="0">{
        if category == nil ||
                userController == nil ||
                userAuthController == nil ||
                adminAuthController == nil ||
                productController == nil ||
                shopping == nil ||
                purchaseController == nil ||
                paymentController == nil </span><span class="cov0" title="0">{
                panic("Invalid parameter")</span>
        }

        // Add logger
        <span class="cov0" title="0">e.Use(middleware.MiddlewareLogger)

        // Custome response
        e.HTTPErrorHandler = func(e error, c echo.Context) </span><span class="cov0" title="0">{
                type Response struct {
                        Code    int    `json:"code"`
                        Message string `json:"message"`
                }
                var response Response
                response.Code = http.StatusInternalServerError // defaul 500
                response.Message = "Internal Server Error"

                if he, ok := e.(*echo.HTTPError); ok </span><span class="cov0" title="0">{
                        response.Code = he.Code
                        response.Message = http.StatusText(he.Code)
                }</span>

                <span class="cov0" title="0">c.Logger().Error(e)

                _ = c.JSON(response.Code, response)</span>
        }

        // Routing
        <span class="cov0" title="0">regis := e.Group("v1/register")
        regis.POST("", userController.InsertUser)
        regis.POST("/admin", adminController.InsertAdmin)

        login := e.Group("v1/login")
        login.POST("", userAuthController.UserLogin)
        login.POST("/admin", adminAuthController.AdminLogin)

        admin := e.Group("v1/admins")
        admin.Use(middleware.JWTMiddleware())
        admin.PUT("/:id", adminController.UpdateAdmin)
        admin.DELETE("/:id", adminController.DeleteAdmin)
        admin.GET("/:id", adminController.FindAdminByID)
        admin.PUT("/:id/password", adminController.UpdateAdminPassword)

        cat := e.Group("v1/categories")
        cat.Use(middleware.JWTMiddleware())
        cat.GET("", category.GetAllCategory)
        cat.GET("/:id", category.FindCategoryById)
        cat.POST("", category.InsertCategory)
        cat.PUT("/:id", category.UpdateCategory)
        cat.DELETE("/:id", category.DeleteCategory)

        product := e.Group("v1/products")
        product.Use(middleware.JWTMiddleware())
        product.GET("", productController.GetAllProduct)
        //product.GET("/:id", productController.FindProductById)
        product.POST("", productController.InsertProduct)
        product.PUT("/:id", productController.UpdateProduct)
        product.DELETE("/:id", productController.DeleteProduct)

        // Routing shoping
        //e.GET("/v1/users/:id/shoppingcart", shopping.GetShoppingCartByUserId)

        shopCart := e.Group("/v1/shoppingcarts")
        shopCart.Use(middleware.JWTMiddleware())
        shopCart.POST("", shopping.NewShoppingCart)
        shopCart.GET("/:id", shopping.GetShopCartDetailById)
        shopCart.POST("/:id/products", shopping.NewItemInShopCart)
        shopCart.PUT("/:id/products/:productid", shopping.ModifyItemInShopCart)
        shopCart.DELETE("/:id/products/:productid", shopping.DeleteItemInShopCart)

        user := e.Group("v1/users")
        user.Use(middleware.JWTMiddleware())
        user.PUT("/:id", userController.UpdateUser)
        user.DELETE("/:id", userController.DeleteUser)
        user.GET("/:id", userController.FindUserByID)
        user.PUT("/:id/password", userController.UpdateUserPassword)
        user.GET("/:id/shoppingcart", shopping.GetShoppingCartByUserId)

        // Checkout
        c_out := e.Group("/v1/checkouts")
        c_out.POST("", checkout.NewCheckoutShoppingCart)
        c_out.GET("", checkout.GetAllCheckout)
        c_out.GET("/:id", checkout.GetCheckoutById)

        purchRec := e.Group("/v1/purchasereceivings")
        purchRec.Use(middleware.JWTMiddleware())
        purchRec.POST("", purchaseController.InsertPurchaseReceiving)
        purchRec.GET("", purchaseController.GetAllPurchaseReceiving)
        purchRec.GET("/:id", purchaseController.FindPurchaseReceivingById)
        purchRec.PUT("/:id", purchaseController.UpdatePurchaseReceiving)
        purchRec.DELETE("/:id", purchaseController.DeletePurchaseReceiving)

        payment := e.Group("/v1/payments")
        purchRec.Use(middleware.JWTMiddleware())
        payment.POST("", paymentController.Call)

        paymentCallback := e.Group("/v1/payments/notif")
        paymentCallback.GET("", paymentController.InsertPayment)</span>

}
</pre>
		
		<pre class="file" id="file6" style="display: none">package admin

import (
        "AltaStore/api/common"
        "AltaStore/api/middleware"
        "AltaStore/api/v1/admin/request"
        "AltaStore/api/v1/admin/response"
        "AltaStore/business/admin"

        uuid "github.com/google/uuid"
        echo "github.com/labstack/echo/v4"
)

//Controller Get item API controller
type Controller struct {
        service admin.Service
}

//NewController Construct item API controller
func NewController(service admin.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{
                service,
        }
}</span>

// InsertAdmin Create new Admin handler
func (controller *Controller) InsertAdmin(c echo.Context) error <span class="cov0" title="0">{
        insertAdminRequest := new(request.InsertAdminRequest)

        if err := c.Bind(insertAdminRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">admin := *insertAdminRequest.ToUpsertAdminSpec()

        err := controller.service.InsertAdmin(admin)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

//GetItemByID Get item by ID echo handler
func (controller *Controller) FindAdminByID(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        admin, err := controller.service.FindAdminByID(id.String())
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.NewGetAdminResponse(*admin)

        return c.JSON(common.SuccessResponseWithData(response))</span>
}

// UpdateAdmin update existing Admin handler
func (controller *Controller) UpdateAdmin(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        adminId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>
        <span class="cov0" title="0">if adminId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>
        <span class="cov0" title="0">updateAdminRequest := new(request.UpdateAdminRequest)

        if err = c.Bind(updateAdminRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">admin := *updateAdminRequest.ToUpsertAdminSpec()

        err = controller.service.UpdateAdmin(id.String(), admin, adminId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

// UpdateAdminPassword update existing Admin handler
func (controller *Controller) UpdateAdminPassword(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        updateAdminPasswordRequest := new(request.UpdateAdminPasswordRequest)

        adminId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>
        <span class="cov0" title="0">if adminId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>
        <span class="cov0" title="0">if err = c.Bind(updateAdminPasswordRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">admin := *updateAdminPasswordRequest.ToUpsertAdminSpec()

        err = controller.service.UpdateAdminPassword(id.String(), admin.NewPassword, admin.OldPassword, adminId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

// DeleteAdmin delete existing Admin handler
func (controller *Controller) DeleteAdmin(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        adminId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>
        <span class="cov0" title="0">if adminId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>
        <span class="cov0" title="0">err = controller.service.DeleteAdmin(id.String(), adminId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package request

import (
        "AltaStore/business/admin"
)

//InsertAdminRequest create Admin request payload
type InsertAdminRequest struct {
        Email     string `json:"email"`
        FirstName string `json:"firstname"`
        LastName  string `json:"lastname"`
        Password  string `json:"password"`
}

//ToUpsertAdminSpec convert into Admin.UpsertAdminSpec object
func (req *InsertAdminRequest) ToUpsertAdminSpec() *admin.InsertAdminSpec <span class="cov0" title="0">{
        var insertAdminSpec admin.InsertAdminSpec

        insertAdminSpec.Email = req.Email
        insertAdminSpec.FirstName = req.FirstName
        insertAdminSpec.LastName = req.LastName
        insertAdminSpec.Password = req.Password

        return &amp;insertAdminSpec
}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">package request

import (
        "AltaStore/business/admin"
)

//UpdateAdminRequest create Admin request payload
type UpdateAdminRequest struct {
        FirstName string `json:"firstname"`
        LastName  string `json:"lastname"`
}

//ToUpsertAdminSpec convert into Admin.UpsertAdminSpec object
func (req *UpdateAdminRequest) ToUpsertAdminSpec() *admin.UpdateAdminSpec <span class="cov0" title="0">{

        var updateAdminSpec admin.UpdateAdminSpec

        updateAdminSpec.FirstName = req.FirstName
        updateAdminSpec.LastName = req.LastName

        return &amp;updateAdminSpec
}</span>
</pre>
		
		<pre class="file" id="file9" style="display: none">package request

import (
        "AltaStore/business/admin"
)

//UpdateAdminRequest create Admin request payload
type UpdateAdminPasswordRequest struct {
        NewPassword string `json:"newpassword"`
        OldPassword string `json:"oldpassword"`
}

//ToUpsertAdminSpec convert into Admin.UpsertAdminSpec object
func (req *UpdateAdminPasswordRequest) ToUpsertAdminSpec() *admin.UpdateAdminPasswordSpec <span class="cov0" title="0">{

        var updateAdminPasswordSpec admin.UpdateAdminPasswordSpec

        updateAdminPasswordSpec.NewPassword = req.NewPassword
        updateAdminPasswordSpec.OldPassword = req.OldPassword

        return &amp;updateAdminPasswordSpec
}</span>
</pre>
		
		<pre class="file" id="file10" style="display: none">package response

import (
        "AltaStore/business/admin"
)

//GetAdminResponse Get Admin by ID response payload
type GetAdminResponse struct {
        ID        string `json:"id"`
        Email     string `json:"email"`
        FirstName string `json:"name"`
        LastName  string `json:"Adminname"`
}

//NewGetAdminResponse construct GetAdminResponse
func NewGetAdminResponse(Admin admin.Admin) *GetAdminResponse <span class="cov0" title="0">{
        var getAdminResponse GetAdminResponse

        getAdminResponse.ID = Admin.ID
        getAdminResponse.Email = Admin.Email
        getAdminResponse.FirstName = Admin.FirstName
        getAdminResponse.LastName = Admin.LastName

        return &amp;getAdminResponse
}</span>
</pre>
		
		<pre class="file" id="file11" style="display: none">package adminauth

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/adminauth/request"
        "AltaStore/api/v1/adminauth/response"
        auth "AltaStore/business/adminauth"
        "net/http"
        "time"

        echo "github.com/labstack/echo/v4"
)

//Controller Get item API controller
type Controller struct {
        service auth.Service
}

//NewController Construct item API controller
func NewController(service auth.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{
                service,
        }
}</span>

//Login by given adminname and password will return JWT token
func (controller *Controller) AdminLogin(c echo.Context) error <span class="cov0" title="0">{
        loginRequest := new(request.LoginRequest)

        if err := c.Bind(loginRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">token, err := controller.service.AdminLogin(loginRequest.Email, loginRequest.Password)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.NewLoginResponse(token)

        cookie := &amp;http.Cookie{}
        cookie.Name = "JWT"
        cookie.Value = token
        cookie.Expires = time.Now().Add(time.Hour * 24)
        cookie.HttpOnly = true

        c.SetCookie(cookie)

        return c.JSON(common.SuccessResponseWithData(response))</span>
}
</pre>
		
		<pre class="file" id="file12" style="display: none">package response

//Login response payload
type LoginResponse struct {
        Token string `json:"token"`
}

//NewLoginResponse construct LoginResponse
func NewLoginResponse(token string) *LoginResponse <span class="cov0" title="0">{
        var LoginResponse LoginResponse

        LoginResponse.Token = token

        return &amp;LoginResponse
}</span>
</pre>
		
		<pre class="file" id="file13" style="display: none">package category

import (
        "AltaStore/api/common"
        "AltaStore/api/middleware"
        "AltaStore/api/v1/category/request"
        "AltaStore/api/v1/category/response"
        "AltaStore/business/category"

        "github.com/google/uuid"
        "github.com/labstack/echo/v4"
)

type Controller struct {
        service category.Service
}

func NewController(service category.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

func (c *Controller) GetAllCategory(ctx echo.Context) error <span class="cov0" title="0">{
        categories, err := c.service.GetAllCategory()
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(
                common.SuccessResponseWithData(
                        response.GetAllCategory(categories).Categories,
                ),
        )</span>
}

func (c *Controller) FindCategoryById(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">category, err := c.service.FindCategoryById(id)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.GetOneCategory(*category)

        return ctx.JSON(common.SuccessResponseWithData(response))</span>
}

func (c *Controller) InsertCategory(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        insertCategory := new(request.InsertCategoryRequest)
        adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>
        <span class="cov0" title="0">if err = ctx.Bind(insertCategory); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.InsertCategory(insertCategory.ToCategorySpec(), adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) UpdateCategory(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        id := ctx.Param("id")
        if _, err = uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">updateCategory := new(request.UpdateCategoryRequest)
        if err = ctx.Bind(updateCategory); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.UpdateCategory(id, updateCategory.ToCategory(), adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) DeleteCategory(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        id := ctx.Param("id")
        adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">if _, err = uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>
        <span class="cov0" title="0">if _, err = uuid.Parse(adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.DeleteCategory(id, adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}
</pre>
		
		<pre class="file" id="file14" style="display: none">package request

import (
        "AltaStore/business/category"
)

type InsertCategoryRequest struct {
        Code string `json:"code"`
        Name string `json:"name"`
}

func (i *InsertCategoryRequest) ToCategorySpec() *category.CategorySpec <span class="cov0" title="0">{
        var spec category.CategorySpec

        spec.Code = i.Code
        spec.Name = i.Name

        return &amp;spec
}</span>
</pre>
		
		<pre class="file" id="file15" style="display: none">package request

import "AltaStore/business/category"

type UpdateCategoryRequest struct {
        Name string `json:"name"`
}

func (u *UpdateCategoryRequest) ToCategory() *category.CategorySpec <span class="cov0" title="0">{
        var spec category.CategorySpec
        spec.Name = u.Name

        return &amp;spec
}</span>
</pre>
		
		<pre class="file" id="file16" style="display: none">package response

import (
        "AltaStore/business/category"
)

type AllCategory struct {
        Categories []OneCategory
}

func GetAllCategory(categories *[]category.Category) *AllCategory <span class="cov0" title="0">{
        var allCategory AllCategory
        var oneCategory OneCategory // temporery format

        for _, value := range *categories </span><span class="cov0" title="0">{
                oneCategory.ID = value.ID
                oneCategory.Code = value.Code
                oneCategory.Name = value.Name
                oneCategory.UpdatedAt = value.UpdatedAt

                allCategory.Categories = append(allCategory.Categories, oneCategory)
        }</span>

        <span class="cov0" title="0">if allCategory.Categories == nil </span><span class="cov0" title="0">{
                allCategory.Categories = []OneCategory{}
        }</span>

        <span class="cov0" title="0">return &amp;allCategory</span>
}
</pre>
		
		<pre class="file" id="file17" style="display: none">package response

import (
        "AltaStore/business/category"
        "time"
)

type OneCategory struct {
        ID        string    `json:"id"`
        Code      string    `json:"code"`
        Name      string    `json:"name"`
        UpdatedAt time.Time `json:"updated_at"`
}

func GetOneCategory(category category.Category) *OneCategory <span class="cov0" title="0">{
        var res OneCategory

        res.ID = category.ID
        res.Code = category.Code
        res.Name = category.Name
        res.UpdatedAt = category.UpdatedAt

        return &amp;res
}</span>
</pre>
		
		<pre class="file" id="file18" style="display: none">package checkout

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/checkout/request"
        "AltaStore/api/v1/checkout/response"
        "AltaStore/business/checkout"

        "github.com/google/uuid"
        echo "github.com/labstack/echo/v4"
)

type Controller struct {
        service checkout.Service
}

func NewController(service checkout.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

func (c *Controller) NewCheckoutShoppingCart(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        checkoutShopCart := new(request.NewCheckoutShoppingCart)

        if err = ctx.Bind(checkoutShopCart); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">snap, err := c.service.NewCheckoutShoppingCart(checkoutShopCart.ToBusinessCheckout())
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithData(snap))</span>
}

func (c *Controller) GetAllCheckout(ctx echo.Context) error <span class="cov0" title="0">{
        listCheckout, err := c.service.GetAllCheckout()
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithData(response.AllCheckout(listCheckout)))</span>
}

func (c *Controller) GetCheckoutById(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">checkoutDetails, err := c.service.GetCheckoutById(id)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithData(checkoutDetails))</span>
}
</pre>
		
		<pre class="file" id="file19" style="display: none">package request

import (
        "AltaStore/business/checkout"
)

type NewCheckoutShoppingCart struct {
        UserId         string `json:"userid" validate:"required"`
        ShoppingCartId string `json:"shoppingcartid" validate:"required"`
        Description    string `json:"description"`
}

func (n *NewCheckoutShoppingCart) ToBusinessCheckout() *checkout.Checkout <span class="cov0" title="0">{
        var checkout checkout.Checkout

        checkout.CreatedBy = n.UserId
        checkout.ShoppingCardId = n.ShoppingCartId
        checkout.Description = n.Description

        return &amp;checkout
}</span>
</pre>
		
		<pre class="file" id="file20" style="display: none">package response

import (
        "AltaStore/business/checkout"
        "time"
)

type CheckoutResponse struct {
        ID             string    `json:"id"`
        ShoppingCardId string    `json:"shoppingcartid"`
        Description    string    `json:"description"`
        CreatedBy      string    `json:"created_by"`
        CreatedAt      time.Time `json:"created_at"`
}

func toCheckoutResponse(checkout checkout.Checkout) CheckoutResponse <span class="cov0" title="0">{
        return CheckoutResponse{
                ID:             checkout.ID,
                ShoppingCardId: checkout.ShoppingCardId,
                Description:    checkout.Description,
                CreatedBy:      checkout.CreatedBy,
                CreatedAt:      checkout.CreatedAt,
        }
}</span>

func AllCheckout(checkout *[]checkout.Checkout) *[]CheckoutResponse <span class="cov0" title="0">{
        var response []CheckoutResponse

        for _, val := range *checkout </span><span class="cov0" title="0">{
                response = append(response, toCheckoutResponse(val))
        }</span>

        <span class="cov0" title="0">if response == nil </span><span class="cov0" title="0">{
                response = []CheckoutResponse{}
        }</span>

        <span class="cov0" title="0">return &amp;response</span>
}
</pre>
		
		<pre class="file" id="file21" style="display: none">package checkoutpayment

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/checkoutpayment/request"
        "AltaStore/business/checkoutpayment"

        "github.com/google/uuid"
        "github.com/labstack/echo/v4"
)

type Controller struct {
        service checkoutpayment.Service
}

func NewController(service checkoutpayment.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

// MidtransTransactionCallbackHandler handles incoming notification about payment status from midtrans.
func (c *Controller) Call(ctx echo.Context) error <span class="cov0" title="0">{
        userid := ctx.QueryParam("userid")

        if _, err := uuid.Parse(userid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">snap, err := c.service.GenerateSnapPayment(userid, uuid.New().String(), 10000)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">return ctx.JSON(
                common.SuccessResponseWithData(snap),
        )</span>
}

// MidtransTransactionCallbackHandler handles incoming notification about payment status from midtrans.
func (c *Controller) InsertPayment(ctx echo.Context) error <span class="cov0" title="0">{
        merchantId := ctx.QueryParam("merchant_id")
        orderId := ctx.QueryParam("order_id")
        statusCode := ctx.QueryParam("status_code")
        transactionStatus := ctx.QueryParam("transaction_status")
        fraudStatus := ctx.QueryParam("fraud_status")

        if _, err := uuid.Parse(orderId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">var newData request.InserPaymentRequest
        newData.OrderId = orderId
        newData.FraudStatus = fraudStatus
        newData.TransactionStatus = transactionStatus
        newData.MerchantId = merchantId
        newData.StatusCode = statusCode
        saveData, err := c.service.InsertPayment(newData.ToPaymentSpec())
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">return ctx.JSON(
                common.SuccessResponseWithData(saveData),
        )</span>
}

// // MidtransTransactionCallbackHandler handles incoming notification about payment status from midtrans.
// func (c *Controller) MidtransTransactionCallbackHandler(ctx echo.Context) error {
//         _ = func(w http.ResponseWriter, r *http.Request) error {
//                 decoder := json.NewDecoder(r.Body)
//                 var notification coreapi.TransactionStatusResponse
//                 err := decoder.Decode(&amp;notification)
//                 if err != nil {
//                         return ctx.JSON(common.NotFoundResponse())
//                 }
//                 if err != nil {
//                         return ctx.JSON(common.NotFoundResponse())
//                 }
//                 err = c.service.ProcessMidtransCallback(&amp;notification)
//                 if err != nil {
//                         return ctx.JSON(common.NotFoundResponse())
//                 }
//                 return ctx.JSON(
//                         common.SuccessResponseWithoutData(),
//                 )
//         }
//         return nil
// }
</pre>
		
		<pre class="file" id="file22" style="display: none">package request

import "AltaStore/business/checkoutpayment"

type InserPaymentRequest struct {
        OrderId           string `json:"order_id"`
        MerchantId        string `json:"merchant_id"`
        StatusCode        string `json:"status_code"`
        TransactionStatus string `json:"transaction_status"`
        FraudStatus       string `json:"fraud_status"`
}

func (u *InserPaymentRequest) ToPaymentSpec() *checkoutpayment.InserPaymentSpec <span class="cov0" title="0">{
        var spec checkoutpayment.InserPaymentSpec

        spec.OrderId = u.OrderId
        spec.MerchantId = u.MerchantId
        spec.StatusCode = u.StatusCode
        spec.TransactionStatus = u.TransactionStatus
        spec.FraudStatus = u.FraudStatus

        return &amp;spec
}</span>
</pre>
		
		<pre class="file" id="file23" style="display: none">package product

import (
        "AltaStore/api/common"
        "AltaStore/api/middleware"
        "AltaStore/api/v1/product/request"
        "AltaStore/api/v1/product/response"
        "AltaStore/business/product"

        "github.com/google/uuid"
        "github.com/labstack/echo/v4"
)

type Controller struct {
        service product.Service
}

func NewController(service product.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

func (c *Controller) GetAllProduct(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.QueryParam("id")
        if id != "" </span><span class="cov0" title="0">{
                if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                        return ctx.JSON(common.BadRequestResponse())
                }</span>
        }

        <span class="cov0" title="0">isActive := ctx.QueryParam("isactive")
        categoryName := ctx.QueryParam("categoryname")
        code := ctx.QueryParam("code")
        name := ctx.QueryParam("name")
        product, err := c.service.GetAllProductByParameter(id, isActive, categoryName, code, name)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(
                common.SuccessResponseWithData(
                        response.GetAll(product).Products,
                ),
        )</span>
}

func (c *Controller) FindProductById(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">product, err := c.service.FindProductById(id)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.GetById(*product)

        return ctx.JSON(common.SuccessResponseWithData(response))</span>
}

func (c *Controller) InsertProduct(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">insertProduct := new(request.InsertProductRequest)

        if err = ctx.Bind(insertProduct); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.InsertProduct(insertProduct.ToProductSpec(), adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) UpdateProduct(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        id := ctx.Param("id")
        if _, err = uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">updateProduct := new(request.UpdateProductRequest)
        if err = ctx.Bind(updateProduct); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.UpdateProduct(id, updateProduct.ToProductSpec(), adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) DeleteProduct(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        id := ctx.Param("id")
        adminId, err := middleware.ExtractToken(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">if _, err = uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if _, err = uuid.Parse(adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.DeleteProduct(id, adminId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}
</pre>
		
		<pre class="file" id="file24" style="display: none">package request

import (
        "AltaStore/business/product"
)

type InsertProductRequest struct {
        Code              string `json:"code"`
        Name              string `json:"name"`
        Price             int64  `json:"price"`
        IsActive          bool   `json:"isactive"`
        ProductCategoryId string `json:"productcategoryid"`
        UnitName          string `json:"unitname"`
        Description       string `json:"description"`
}

func (i *InsertProductRequest) ToProductSpec() *product.InsertProductSpec <span class="cov0" title="0">{
        var spec product.InsertProductSpec

        spec.Code = i.Code
        spec.Name = i.Name
        spec.Price = i.Price
        spec.IsActive = i.IsActive
        spec.ProductCategoryId = i.ProductCategoryId
        spec.UnitName = i.UnitName
        spec.Description = i.Description

        return &amp;spec
}</span>
</pre>
		
		<pre class="file" id="file25" style="display: none">package request

import "AltaStore/business/product"

type UpdateProductRequest struct {
        Name              string `json:"name"`
        Price             int64  `json:"price"`
        IsActive          bool   `json:"isactive"`
        ProductCategoryId string `json:"productcategoryid"`
        UnitName          string `json:"unitname"`
        Description       string `json:"description"`
}

func (u *UpdateProductRequest) ToProductSpec() *product.UpdateProductSpec <span class="cov0" title="0">{
        var spec product.UpdateProductSpec

        spec.Name = u.Name
        spec.Price = u.Price
        spec.IsActive = u.IsActive
        spec.ProductCategoryId = u.ProductCategoryId
        spec.UnitName = u.UnitName
        spec.Description = u.Description

        return &amp;spec
}</span>
</pre>
		
		<pre class="file" id="file26" style="display: none">package response

import "AltaStore/business/product"

type Product struct {
        ID                  string `json:"id"`
        Code                string `json:"code"`
        Name                string `json:"name"`
        Price               int64  `json:"price"`
        Qty                 int32  `json:"qty"`
        QtyCart             int32  `json:"qtycart"`
        IsActive            bool   `json:"isactive"`
        ProductCategoryName string `json:"productcategoryname"`
        UnitName            string `json:"unitname"`
        Description         string `json:"description"`
}

type Products struct {
        Products []Product
}

func GetAll(products *[]product.Product) *Products <span class="cov0" title="0">{
        var allProduct Products
        var prod Product
        for _, val := range *products </span><span class="cov0" title="0">{

                prod.ID = val.ID
                prod.Code = val.Code
                prod.Name = val.Name
                prod.Price = val.Price
                prod.Qty = val.Qty
                prod.QtyCart = val.QtyCart
                prod.IsActive = val.IsActive
                prod.ProductCategoryName = val.ProductCategoryName
                prod.UnitName = val.UnitName
                prod.Description = val.Description

                allProduct.Products = append(allProduct.Products, prod)
        }</span>

        <span class="cov0" title="0">if allProduct.Products == nil </span><span class="cov0" title="0">{
                allProduct.Products = []Product{}
        }</span>

        <span class="cov0" title="0">return &amp;allProduct</span>
}
</pre>
		
		<pre class="file" id="file27" style="display: none">package response

import (
        "AltaStore/business/product"
)

type ProductById struct {
        ID                  string `json:"id"`
        Code                string `json:"code"`
        Name                string `json:"name"`
        Price               int64  `json:"price"`
        Qty                 int32  `json:"qty"`
        QtyCart             int32  `json:"qtycart"`
        IsActive            bool   `json:"isactive"`
        ProductCategoryID   string `json:"ProductCategoryid"`
        ProductCategoryName string `json:"ProductCategoryname"`
        UnitName            string `json:"unitname"`
        Description         string `json:"description"`
}

func GetById(product product.Product) *ProductById <span class="cov0" title="0">{
        var prod ProductById

        prod.ID = product.ID
        prod.Code = product.Code
        prod.Name = product.Name
        prod.Price = product.Price
        prod.Qty = product.Qty
        prod.Qty = product.Qty
        prod.IsActive = product.IsActive
        prod.ProductCategoryID = product.ProductCategoryId
        prod.ProductCategoryName = product.ProductCategoryName
        prod.UnitName = product.UnitName
        prod.Description = product.Description

        return &amp;prod
}</span>
</pre>
		
		<pre class="file" id="file28" style="display: none">package purchasereceiving

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/purchasereceiving/request"
        "AltaStore/api/v1/purchasereceiving/response"
        "AltaStore/business/purchasereceiving"

        "github.com/google/uuid"
        echo "github.com/labstack/echo/v4"
)

type Controller struct {
        service purchasereceiving.Service
}

func NewController(service purchasereceiving.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

func (c *Controller) InsertPurchaseReceiving(ctx echo.Context) error <span class="cov0" title="0">{
        var err error
        adminid := ctx.QueryParam("adminid")

        if _, err := uuid.Parse(adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">insertData := new(request.InsertPurchaseReceivingRequest)

        if err = ctx.Bind(insertData); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.InsertPurchaseReceiving(insertData.ToPurchaseReceivingSpec(), adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) UpdatePurchaseReceiving(ctx echo.Context) error <span class="cov0" title="0">{
        var err error
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">adminid := ctx.QueryParam("adminid")

        if _, err := uuid.Parse(adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">updateData := new(request.UpdatePurchaseReceivingRequest)
        if err = ctx.Bind(updateData); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.UpdatePurchaseReceiving(id, updateData.ToPurchaseReceivingSpec(), adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) DeletePurchaseReceiving(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        id := ctx.Param("id")
        adminid := ctx.QueryParam("adminid")

        if _, err = uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>
        <span class="cov0" title="0">if _, err = uuid.Parse(adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">if err = c.service.DeletePurchaseReceiving(id, adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) GetAllPurchaseReceiving(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.QueryParam("id")
        if id != "" </span><span class="cov0" title="0">{
                if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                        return ctx.JSON(common.BadRequestResponse())
                }</span>
        }

        <span class="cov0" title="0">adminid := ctx.QueryParam("adminid")

        if _, err := uuid.Parse(adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">code := ctx.QueryParam("code")
        data, err := c.service.GetAllPurchaseReceivingByParameter(code, adminid)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(
                common.SuccessResponseWithData(
                        response.GetAll(data).PurchaseReceivings,
                ),
        )</span>
}

func (c *Controller) FindPurchaseReceivingById(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">adminid := ctx.QueryParam("adminid")

        if _, err := uuid.Parse(adminid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">data, err := c.service.GetPurchaseReceivingById(id, adminid)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.GetById(*data)

        return ctx.JSON(common.SuccessResponseWithData(response))</span>
}
</pre>
		
		<pre class="file" id="file29" style="display: none">package request

import (
        "AltaStore/business/purchasereceiving"
        "time"
)

type InsertPurchaseReceivingRequest struct {
        UserId       string                                 `json:"userid"`
        Code         string                                 `json:"code"`
        DateReceived time.Time                              `json:"datereceived"`
        ReceivedBy   string                                 `json:"receivedby"`
        Description  string                                 `json:"description"`
        Details      []InsertPurchaseReceivingDetailRequest `json:"details"`
}

func (i *InsertPurchaseReceivingRequest) ToPurchaseReceivingSpec() *purchasereceiving.InsertPurchaseReceivingSpec <span class="cov0" title="0">{
        var spec purchasereceiving.InsertPurchaseReceivingSpec

        spec.Code = i.Code
        spec.DateReceived = i.DateReceived
        spec.ReceivedBy = i.ReceivedBy
        spec.Description = i.Description

        var detail purchasereceiving.InsertPurchaseReceivingDetailSpec
        for _, val := range i.Details </span><span class="cov0" title="0">{
                detail.ProductId = val.ProductId
                detail.Price = val.Price
                detail.Qty = val.Qty

                spec.Details = append(spec.Details, detail)
        }</span>

        <span class="cov0" title="0">return &amp;spec</span>
}
</pre>
		
		<pre class="file" id="file30" style="display: none">package request

import (
        "AltaStore/business/purchasereceiving"
        "time"
)

type UpdatePurchaseReceivingRequest struct {
        UserId       string                                 `json:"userid"`
        Code         string                                 `json:"code"`
        DateReceived time.Time                              `json:"datereceived"`
        ReceivedBy   string                                 `json:"receivedby"`
        Description  string                                 `json:"description"`
        Details      []UpdatePurchaseReceivingDetailRequest `json:"details"`
}

func (i *UpdatePurchaseReceivingRequest) ToPurchaseReceivingSpec() *purchasereceiving.UpdatePurchaseReceivingSpec <span class="cov0" title="0">{
        var spec purchasereceiving.UpdatePurchaseReceivingSpec

        spec.Code = i.Code
        spec.DateReceived = i.DateReceived
        spec.ReceivedBy = i.ReceivedBy
        spec.Description = i.Description

        var detail purchasereceiving.UpdatePurchaseReceivingDetailSpec
        for _, val := range i.Details </span><span class="cov0" title="0">{
                detail.ID = val.ID
                detail.ProductId = val.ProductId
                detail.Price = val.Price
                detail.Qty = val.Qty
                detail.IsDelete = val.IsDelete

                spec.Details = append(spec.Details, detail)
        }</span>

        <span class="cov0" title="0">return &amp;spec</span>
}
</pre>
		
		<pre class="file" id="file31" style="display: none">package response

import (
        "AltaStore/business/purchasereceiving"
        "time"
)

type PurchaseReceiving struct {
        ID           string    `json:"id"`
        Code         string    `json:"code"`
        DateReceived time.Time `json:"datereceived"`
        ReceivedBy   string    `json:"receivedby"`
        Description  string    `json:"description"`
}

type PurchaseReceivings struct {
        PurchaseReceivings []PurchaseReceiving
}

func GetAll(purchasereceivings *[]purchasereceiving.PurchaseReceiving) *PurchaseReceivings <span class="cov0" title="0">{
        var allPurchases PurchaseReceivings
        var purchase PurchaseReceiving
        for _, val := range *purchasereceivings </span><span class="cov0" title="0">{

                purchase.ID = val.ID
                purchase.Code = val.Code
                purchase.DateReceived = val.DateReceived
                purchase.ReceivedBy = val.ReceivedBy
                purchase.Description = val.Description

                allPurchases.PurchaseReceivings = append(allPurchases.PurchaseReceivings, purchase)
        }</span>

        <span class="cov0" title="0">if allPurchases.PurchaseReceivings == nil </span><span class="cov0" title="0">{
                allPurchases.PurchaseReceivings = []PurchaseReceiving{}
        }</span>

        <span class="cov0" title="0">return &amp;allPurchases</span>
}
</pre>
		
		<pre class="file" id="file32" style="display: none">package response

import (
        "AltaStore/business/purchasereceiving"
        "time"
)

type PurchaseReceivingById struct {
        ID           string    `json:"id"`
        Code         string    `json:"code"`
        DateReceived time.Time `json:"datereceived"`
        ReceivedBy   string    `json:"receivedby"`
        Description  string    `json:"description"`
        Details      []Detail  `json:"details"`
}

type Detail struct {
        ID        string `json:"id"`
        ProductId string `json:"productid"`
        Qty       int32  `json:"qty"`
        Price     int64  `json:"price"`
}

func GetById(purchaseReceiving purchasereceiving.PurchaseReceiving) *PurchaseReceivingById <span class="cov0" title="0">{
        var purchase PurchaseReceivingById

        purchase.ID = purchaseReceiving.ID
        purchase.Code = purchaseReceiving.Code
        purchase.DateReceived = purchaseReceiving.DateReceived
        purchase.ReceivedBy = purchaseReceiving.ReceivedBy
        purchase.Description = purchaseReceiving.Description

        var det Detail
        for _, val := range purchaseReceiving.Details </span><span class="cov0" title="0">{
                det.ProductId = val.ProductId
                det.ID = val.ID
                det.Qty = val.Qty
                det.Price = val.Price
                purchase.Details = append(purchase.Details, det)
        }</span>
        <span class="cov0" title="0">return &amp;purchase</span>
}
</pre>
		
		<pre class="file" id="file33" style="display: none">package shopping

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/shopping/request"
        "AltaStore/api/v1/shopping/response"
        "AltaStore/business/shopping"

        "github.com/google/uuid"
        echo "github.com/labstack/echo/v4"
)

type Controller struct {
        service shopping.Service
}

func NewController(service shopping.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{service}
}</span>

func (c *Controller) GetShoppingCartByUserId(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">shoppCart, err := c.service.GetShoppingCartByUserId(id)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.GetOneResponse(shoppCart)

        return ctx.JSON(common.SuccessResponseWithData(response))</span>
}

func (c *Controller) NewShoppingCart(ctx echo.Context) error <span class="cov0" title="0">{
        var err error

        payload := new(request.InsertShoppingCart)

        if err = ctx.Bind(payload); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">if _, err = uuid.Parse(payload.UserId); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">result, err := c.service.NewShoppingCart(payload.UserId, payload.Description)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.GetOneResponse(result)

        return ctx.JSON(common.SuccessResponseWithData(response))</span>
}

func (c *Controller) GetShopCartDetailById(ctx echo.Context) error <span class="cov0" title="0">{
        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">itemDetail, err := c.service.GetShopCartDetailById(id)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithData(itemDetail))</span>
}

func (c *Controller) NewItemInShopCart(ctx echo.Context) error <span class="cov0" title="0">{
        var item = new(request.DetailItemInShopCart)

        id := ctx.Param("id")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">if err := ctx.Bind(item); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">err := c.service.NewItemInShopCart(id, item)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}

func (c *Controller) ModifyItemInShopCart(ctx echo.Context) error <span class="cov0" title="0">{
        var item = new(request.DetailItemInShopCart)

        id := ctx.Param("id")
        productid := ctx.Param("productid")

        if _, err := uuid.Parse(id); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">if _, err := uuid.Parse(productid); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">if err := ctx.Bind(item); err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">err := c.service.ModifyItemInShopCart(id, productid, item)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>

}

func (c *Controller) DeleteItemInShopCart(ctx echo.Context) error <span class="cov0" title="0">{
        var err1, err2 error

        id := ctx.Param("id")
        productId := ctx.Param("productid")

        _, err1 = uuid.Parse(id)
        _, err2 = uuid.Parse(productId)

        if err1 != nil || err2 != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">err := c.service.DeleteItemInShopCart(id, productId)
        if err != nil </span><span class="cov0" title="0">{
                return ctx.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return ctx.JSON(common.SuccessResponseWithoutData())</span>
}
</pre>
		
		<pre class="file" id="file34" style="display: none">package response

import "AltaStore/business/shopping"

func GetOneResponse(data *shopping.ShoppCart) *ShoppData <span class="cov0" title="0">{
        return &amp;ShoppData{
                ID:          data.ID,
                IsCheckOut:  data.IsCheckOut,
                Description: data.Description,
                UpdatedAt:   data.UpdatedAt,
        }
}</span>
</pre>
		
		<pre class="file" id="file35" style="display: none">package user

import (
        "AltaStore/api/common"
        "AltaStore/api/middleware"
        "AltaStore/api/v1/user/request"
        "AltaStore/api/v1/user/response"
        "AltaStore/business/user"

        uuid "github.com/google/uuid"
        echo "github.com/labstack/echo/v4"
)

//Controller Get item API controller
type Controller struct {
        service user.Service
}

//NewController Construct item API controller
func NewController(service user.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{
                service,
        }
}</span>

// InsertUser Create new user handler
func (controller *Controller) InsertUser(c echo.Context) error <span class="cov0" title="0">{
        insertUserRequest := new(request.InsertUserRequest)

        if err := c.Bind(insertUserRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">user := *insertUserRequest.ToUpsertUserSpec()

        err := controller.service.InsertUser(user)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

//GetItemByID Get item by ID echo handler
func (controller *Controller) FindUserByID(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        user, err := controller.service.FindUserByID(id.String())
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.NewGetUserResponse(*user)

        return c.JSON(common.SuccessResponseWithData(response))</span>
}

// UpdateUser update existing user handler
func (controller *Controller) UpdateUser(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        userId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">if userId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>

        <span class="cov0" title="0">updateUserRequest := new(request.UpdateUserRequest)

        if err := c.Bind(updateUserRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">user := *updateUserRequest.ToUpsertUserSpec()

        err = controller.service.UpdateUser(id.String(), user, userId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

// UpdateUserPassword update existing user handler
func (controller *Controller) UpdateUserPassword(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        userId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">if userId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>

        <span class="cov0" title="0">updateUserPasswordRequest := new(request.UpdateUserPasswordRequest)

        if err := c.Bind(updateUserPasswordRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>
        <span class="cov0" title="0">user := *updateUserPasswordRequest.ToUpsertUserSpec()

        err = controller.service.UpdateUserPassword(id.String(), user.NewPassword, user.OldPassword, userId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}

// DeleteUser delete existing user handler
func (controller *Controller) DeleteUser(c echo.Context) error <span class="cov0" title="0">{
        id, _ := uuid.Parse(c.Param("id"))

        userId, err := middleware.ExtractToken(c)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.UnAuthorizedResponse())
        }</span>

        <span class="cov0" title="0">if userId != id.String() </span><span class="cov0" title="0">{
                return c.JSON(common.ForbiddenResponse())
        }</span>

        <span class="cov0" title="0">err = controller.service.DeleteUser(id.String(), userId)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">return c.JSON(common.SuccessResponseWithoutData())</span>
}
</pre>
		
		<pre class="file" id="file36" style="display: none">package request

import (
        "AltaStore/business/user"
)

//InsertUserRequest create User request payload
type InsertUserRequest struct {
        Email     string `json:"email"`
        FirstName string `json:"firstname"`
        LastName  string `json:"lastname"`
        Password  string `json:"password"`
}

//ToUpsertUserSpec convert into User.UpsertUserSpec object
func (req *InsertUserRequest) ToUpsertUserSpec() *user.InsertUserSpec <span class="cov0" title="0">{
        var insertUserSpec user.InsertUserSpec

        insertUserSpec.Email = req.Email
        insertUserSpec.FirstName = req.FirstName
        insertUserSpec.LastName = req.LastName
        insertUserSpec.Password = req.Password

        return &amp;insertUserSpec
}</span>
</pre>
		
		<pre class="file" id="file37" style="display: none">package request

import (
        "AltaStore/business/user"
)

//UpdateUserRequest create User request payload
type UpdateUserRequest struct {
        FirstName string `json:"firstname"`
        LastName  string `json:"lastname"`
        HandPhone string `json:"handphone"`
        Address   string `json:"address"`
}

//ToUpsertUserSpec convert into User.UpsertUserSpec object
func (req *UpdateUserRequest) ToUpsertUserSpec() *user.UpdateUserSpec <span class="cov0" title="0">{

        var updateUserSpec user.UpdateUserSpec

        updateUserSpec.FirstName = req.FirstName
        updateUserSpec.LastName = req.LastName
        updateUserSpec.HandPhone = req.HandPhone
        updateUserSpec.Address = req.Address

        return &amp;updateUserSpec
}</span>
</pre>
		
		<pre class="file" id="file38" style="display: none">package request

import (
        "AltaStore/business/user"
)

//UpdateUserRequest create User request payload
type UpdateUserPasswordRequest struct {
        NewPassword string `json:"newpassword"`
        OldPassword string `json:"oldpassword"`
}

//ToUpsertUserSpec convert into User.UpsertUserSpec object
func (req *UpdateUserPasswordRequest) ToUpsertUserSpec() *user.UpdateUserPasswordSpec <span class="cov0" title="0">{

        var updateUserPasswordSpec user.UpdateUserPasswordSpec

        updateUserPasswordSpec.NewPassword = req.NewPassword
        updateUserPasswordSpec.OldPassword = req.OldPassword

        return &amp;updateUserPasswordSpec
}</span>
</pre>
		
		<pre class="file" id="file39" style="display: none">package response

import (
        "AltaStore/business/user"
)

//GetUserResponse Get user by ID response payload
type GetUserResponse struct {
        ID        string `json:"id"`
        Email     string `json:"email"`
        FirstName string `json:"name"`
        LastName  string `json:"username"`
        HandPhone string `json:"handphone"`
        Address   string `json:"address"`
}

//NewGetUserResponse construct GetUserResponse
func NewGetUserResponse(user user.User) *GetUserResponse <span class="cov0" title="0">{
        var getUserResponse GetUserResponse

        getUserResponse.ID = user.ID
        getUserResponse.Email = user.Email
        getUserResponse.FirstName = user.FirstName
        getUserResponse.LastName = user.LastName
        getUserResponse.HandPhone = user.HandPhone
        getUserResponse.Address = user.Address

        return &amp;getUserResponse
}</span>
</pre>
		
		<pre class="file" id="file40" style="display: none">package userauth

import (
        "AltaStore/api/common"
        "AltaStore/api/v1/userauth/request"
        "AltaStore/api/v1/userauth/response"
        auth "AltaStore/business/userauth"
        "net/http"
        "time"

        echo "github.com/labstack/echo/v4"
)

//Controller Get item API controller
type Controller struct {
        service auth.Service
}

//NewController Construct item API controller
func NewController(service auth.Service) *Controller <span class="cov0" title="0">{
        return &amp;Controller{
                service,
        }
}</span>

//Login by given username and password will return JWT token
func (controller *Controller) UserLogin(c echo.Context) error <span class="cov0" title="0">{
        loginRequest := new(request.LoginRequest)

        if err := c.Bind(loginRequest); err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.BadRequestResponse())
        }</span>

        <span class="cov0" title="0">token, err := controller.service.UserLogin(loginRequest.Email, loginRequest.Password)
        if err != nil </span><span class="cov0" title="0">{
                return c.JSON(common.NewBusinessErrorResponse(err))
        }</span>

        <span class="cov0" title="0">response := response.NewLoginResponse(token)

        cookie := &amp;http.Cookie{}
        cookie.Name = "JWT"
        cookie.Value = token
        cookie.Expires = time.Now().Add(time.Hour * 24)
        cookie.HttpOnly = true

        c.SetCookie(cookie)

        return c.JSON(common.SuccessResponseWithData(response))</span>
}
</pre>
		
		<pre class="file" id="file41" style="display: none">package response

//Login response payload
type LoginResponse struct {
        Token string `json:"token"`
}

//NewLoginResponse construct LoginResponse
func NewLoginResponse(token string) *LoginResponse <span class="cov0" title="0">{
        var LoginResponse LoginResponse

        LoginResponse.Token = token

        return &amp;LoginResponse
}</span>
</pre>
		
		<pre class="file" id="file42" style="display: none">package admin

import (
        "time"
)

//Admin
type Admin struct {
        ID        string
        Email     string
        FirstName string
        LastName  string
        Password  string
        CreatedAt time.Time
        CreatedBy string
        UpdatedAt time.Time
        UpdatedBy string
        DeletedAt time.Time
        DeletedBy string
}

//NewAdmin create new Admin
func NewAdmin(
        id string,
        email string,
        firstname string,
        lastname string,
        password string,
        creator string,
        createdAt time.Time) Admin <span class="cov8" title="1">{

        return Admin{
                ID:        id,
                Email:     email,
                FirstName: firstname,
                LastName:  lastname,
                Password:  password,
                CreatedAt: createdAt,
                CreatedBy: creator,
        }
}</span>

//ModifyAdmin update existing AdminData
func (oldData *Admin) ModifyAdmin(
        newFirstName,
        newLastName string,
        updatedAt time.Time,
        updater string) Admin <span class="cov8" title="1">{

        return Admin{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: newFirstName,
                LastName:  newLastName,
                Password:  oldData.Password,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: updatedAt,
                UpdatedBy: updater,
        }
}</span>

// //ModifyAdminToken update existing AdminData
// func (oldData *Admin) ModifyAdminToken(
//         newToken string,
//         updatedAt time.Time) Admin {

//         return Admin{
//                 ID:        oldData.ID,
//                 Email:     oldData.Email,
//                 FirstName: oldData.FirstName,
//                 LastName:  oldData.LastName,
//                 Password:  oldData.Password,
//                 Token:     newToken,
//                 CreatedAt: oldData.CreatedAt,
//                 CreatedBy: oldData.CreatedBy,
//                 UpdatedAt: updatedAt,
//                 UpdatedBy: oldData.ID,
//         }
// }

//ModifyAdminPassword update existing AdminData
func (oldData *Admin) ModifyAdminPassword(
        newPassword string,
        modifier string,
        updatedAt time.Time) Admin <span class="cov8" title="1">{

        return Admin{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: oldData.FirstName,
                LastName:  oldData.LastName,
                Password:  newPassword,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: updatedAt,
                UpdatedBy: modifier,
        }
}</span>

func (oldData *Admin) DeleteAdmin(
        deleteAt time.Time,
        deleter string) Admin <span class="cov8" title="1">{

        return Admin{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: oldData.FirstName,
                LastName:  oldData.LastName,
                Password:  oldData.Password,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: oldData.UpdatedAt,
                UpdatedBy: oldData.UpdatedBy,
                DeletedAt: deleteAt,
                DeletedBy: deleter,
        }
}</span>
</pre>
		
		<pre class="file" id="file43" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        admin "AltaStore/business/admin"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// DeleteAdmin provides a mock function with given fields: Admin
func (_m *Repository) DeleteAdmin(Admin admin.Admin) error <span class="cov8" title="1">{
        ret := _m.Called(Admin)

        var r0 error
        if rf, ok := ret.Get(0).(func(admin.Admin) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Admin)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// FindAdminByEmail provides a mock function with given fields: email
func (_m *Repository) FindAdminByEmail(email string) (*admin.Admin, error) <span class="cov8" title="1">{
        ret := _m.Called(email)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(email)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindAdminByEmailAndPassword provides a mock function with given fields: email, password
func (_m *Repository) FindAdminByEmailAndPassword(email string, password string) (*admin.Admin, error) <span class="cov8" title="1">{
        ret := _m.Called(email, password)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string, string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindAdminByID provides a mock function with given fields: id
func (_m *Repository) FindAdminByID(id string) (*admin.Admin, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertAdmin provides a mock function with given fields: Admin
func (_m *Repository) InsertAdmin(Admin admin.Admin) error <span class="cov8" title="1">{
        ret := _m.Called(Admin)

        var r0 error
        if rf, ok := ret.Get(0).(func(admin.Admin) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Admin)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateAdmin provides a mock function with given fields: Admin
func (_m *Repository) UpdateAdmin(Admin admin.Admin) error <span class="cov8" title="1">{
        ret := _m.Called(Admin)

        var r0 error
        if rf, ok := ret.Get(0).(func(admin.Admin) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Admin)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateAdminPassword provides a mock function with given fields: Admin
func (_m *Repository) UpdateAdminPassword(Admin admin.Admin) error <span class="cov8" title="1">{
        ret := _m.Called(Admin)

        var r0 error
        if rf, ok := ret.Get(0).(func(admin.Admin) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Admin)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file44" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        admin "AltaStore/business/admin"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeleteAdmin provides a mock function with given fields: id, modifier
func (_m *Service) DeleteAdmin(id string, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// FindAdminByEmail provides a mock function with given fields: email
func (_m *Service) FindAdminByEmail(email string) (*admin.Admin, error) <span class="cov0" title="0">{
        ret := _m.Called(email)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(email)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// FindAdminByEmailAndPassword provides a mock function with given fields: email, password
func (_m *Service) FindAdminByEmailAndPassword(email string, password string) (*admin.Admin, error) <span class="cov8" title="1">{
        ret := _m.Called(email, password)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string, string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindAdminByID provides a mock function with given fields: id
func (_m *Service) FindAdminByID(id string) (*admin.Admin, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *admin.Admin
        if rf, ok := ret.Get(0).(func(string) *admin.Admin); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*admin.Admin)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertAdmin provides a mock function with given fields: insertAdminSpec
func (_m *Service) InsertAdmin(insertAdminSpec admin.InsertAdminSpec) error <span class="cov0" title="0">{
        ret := _m.Called(insertAdminSpec)

        var r0 error
        if rf, ok := ret.Get(0).(func(admin.InsertAdminSpec) error); ok </span><span class="cov0" title="0">{
                r0 = rf(insertAdminSpec)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateAdmin provides a mock function with given fields: id, updateAdminSpec, modifier
func (_m *Service) UpdateAdmin(id string, updateAdminSpec admin.UpdateAdminSpec, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, updateAdminSpec, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, admin.UpdateAdminSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, updateAdminSpec, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateAdminPassword provides a mock function with given fields: id, password, oldPassword, modifier
func (_m *Service) UpdateAdminPassword(id string, password string, oldPassword string, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, password, oldPassword, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string, string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, password, oldPassword, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}
</pre>
		
		<pre class="file" id="file45" style="display: none">package admin

import (
        "AltaStore/business"
        "AltaStore/util/validator"
        "time"

        "github.com/google/uuid"
        "golang.org/x/crypto/bcrypt"
)

//InsertAdminSpec create Admin spec
type InsertAdminSpec struct {
        Email     string `validate:"required"`
        FirstName string `validate:"required"`
        LastName  string `validate:"required"`
        Password  string `validate:"required"`
}

type UpdateAdminSpec struct {
        Email     string `validate:"required"`
        FirstName string `validate:"required"`
        LastName  string `validate:"required"`
}

type UpdateAdminPasswordSpec struct {
        NewPassword string `validate:"required"`
        OldPassword string `validate:"required"`
}

//=============== The implementation of those interface put below =======================
type service struct {
        repository Repository
}

//NewService Construct Admin service object
func NewService(repository Repository) Service <span class="cov8" title="1">{
        return &amp;service{
                repository,
        }
}</span>

//InsertAdmin Create new Admin and store into database
func (s *service) InsertAdmin(insertAdminSpec InsertAdminSpec) error <span class="cov8" title="1">{
        err := validator.GetValidator().Struct(insertAdminSpec)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>

        <span class="cov8" title="1">admin, _ := s.repository.FindAdminByEmail(insertAdminSpec.Email)
        if admin != nil </span><span class="cov8" title="1">{
                return business.ErrDataExists
        }</span>

        <span class="cov8" title="1">hashedPassword, err := bcrypt.GenerateFromPassword([]byte(insertAdminSpec.Password), bcrypt.DefaultCost)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>
        <span class="cov8" title="1">var newuuid = uuid.New().String()
        Admin := NewAdmin(
                newuuid,
                insertAdminSpec.Email,
                insertAdminSpec.FirstName,
                insertAdminSpec.LastName,
                string(hashedPassword),
                newuuid,
                time.Now(),
        )

        err = s.repository.InsertAdmin(Admin)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}

//FindAdminByAdminnameAndPassword If data not found will return nil
func (s *service) FindAdminByEmailAndPassword(email string, password string) (*Admin, error) <span class="cov8" title="1">{
        return s.repository.FindAdminByEmailAndPassword(email, password)
}</span>

//FindAdminByAdminnameAndPassword If data not found will return nil
func (s *service) FindAdminByEmail(email string) (*Admin, error) <span class="cov8" title="1">{
        return s.repository.FindAdminByEmail(email)
}</span>

//FindAdminByID If data not found will return nil without error
func (s *service) FindAdminByID(id string) (*Admin, error) <span class="cov8" title="1">{
        return s.repository.FindAdminByID(id)
}</span>

//UpdateAdminPaasword if data not found or old password wrong will return error
func (s *service) UpdateAdminPassword(id string, newpassword, oldPassword string, modifier string) error <span class="cov8" title="1">{

        admin, err := s.repository.FindAdminByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if admin == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if admin.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> {
                _, err := s.repository.FindAdminByEmailAndPassword(admin.Email, oldPassword)
                if err != nil </span><span class="cov8" title="1">{
                        return business.ErrPasswordMisMatch
                }</span>
        }
        <span class="cov8" title="1">hashedPassword, err := bcrypt.GenerateFromPassword([]byte(newpassword), bcrypt.DefaultCost)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>
        <span class="cov8" title="1">modifiedAdmin := admin.ModifyAdminPassword(
                string(hashedPassword),
                modifier,
                time.Now(),
        )

        return s.repository.UpdateAdminPassword(modifiedAdmin)</span>
}

//UpdateAdmin if data not found will return error
func (s *service) UpdateAdmin(id string, updateAdminSpec UpdateAdminSpec, modifier string) error <span class="cov8" title="1">{
        admin, err := s.repository.FindAdminByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if admin == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if admin.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>

        <span class="cov8" title="1">modifiedAdmin := admin.ModifyAdmin(
                updateAdminSpec.FirstName,
                updateAdminSpec.LastName,
                time.Now(),
                modifier,
        )

        return s.repository.UpdateAdmin(modifiedAdmin)</span>
}

//DeleteAdmin if data not found will return error
func (s *service) DeleteAdmin(id string, modifier string) error <span class="cov8" title="1">{
        admin, err := s.repository.FindAdminByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if admin == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>

        <span class="cov8" title="1">deleteAdmin := admin.DeleteAdmin(
                time.Now(),
                modifier,
        )

        return s.repository.DeleteAdmin(deleteAdmin)</span>
}
</pre>
		
		<pre class="file" id="file46" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        admin "AltaStore/business/admin"
        adminauth "AltaStore/business/adminauth"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// AdminLogin provides a mock function with given fields: email, password
func (_m *Service) AdminLogin(email string, password string) (string, error) <span class="cov0" title="0">{
        ret := _m.Called(email, password)

        var r0 string
        if rf, ok := ret.Get(0).(func(string, string) string); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Get(0).(string)
        }</span>

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// CreateToken provides a mock function with given fields: _a0
func (_m *Service) CreateToken(_a0 *admin.Admin) (*adminauth.TokenDetails, error) <span class="cov0" title="0">{
        ret := _m.Called(_a0)

        var r0 *adminauth.TokenDetails
        if rf, ok := ret.Get(0).(func(*admin.Admin) *adminauth.TokenDetails); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*adminauth.TokenDetails)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(*admin.Admin) error); ok </span><span class="cov0" title="0">{
                r1 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file47" style="display: none">package adminauth

import (
        "AltaStore/business"
        "AltaStore/business/admin"
        "AltaStore/config"
        "time"

        "github.com/golang-jwt/jwt"
        uuid "github.com/google/uuid"
)

//=============== The implementation of those interface put below =======================
type service struct {
        adminService admin.Service
        //authService Repository
}

// //NewService Construct admin service object
// func NewService(adminService admin.Service, authService Repository) Service {
//         return &amp;service{
//                 adminService, authService,
//         }
// }

//NewService Construct admin service object
func NewService(adminService admin.Service) Service <span class="cov8" title="1">{
        return &amp;service{
                adminService,
        }
}</span>

//Login by given admin Email and Password, return error if not exist
func (s *service) AdminLogin(adminname string, password string) (string, error) <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByEmailAndPassword(adminname, password)
        if err != nil </span><span class="cov8" title="1">{
                return "", business.ErrUnAuthorized
        }</span>
        <span class="cov8" title="1">td, err := s.CreateToken(admin)
        if err != nil </span><span class="cov0" title="0">{
                return "", business.ErrUnAuthorized
        }</span>
        // err = s.authService.InsertToken(admin, td)
        // if err != nil {
        //         return "", business.ErrNotFound
        // }
        <span class="cov8" title="1">return td.AccessToken, nil</span>
}

func (s *service) CreateToken(admin *admin.Admin) (*TokenDetails, error) <span class="cov8" title="1">{
        td := &amp;TokenDetails{}
        td.AtExpires = time.Now().Add(time.Hour * 24).Unix()
        td.AccessUuid = uuid.New().String()

        var err error
        //Creating Access Token
        atClaims := jwt.MapClaims{}
        atClaims["authorized"] = true
        atClaims["access_uuid"] = td.AccessUuid
        atClaims["userId"] = admin.ID
        atClaims["exp"] = td.AtExpires
        at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims)
        td.AccessToken, err = at.SignedString([]byte(config.GetConfig().JwtSecretKey))
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return td, nil</span>
}
</pre>
		
		<pre class="file" id="file48" style="display: none">package category

import (
        "time"

        "github.com/google/uuid"
)

// Membuat core data pada domain bisnis
type Category struct {
        ID        string
        Code      string
        Name      string
        CreatedAt time.Time
        CreatedBy string
        UpdatedAt time.Time
        UpdatedBy string
}

// fungsi menambahkan data kategory
func NewProductCategory(code string, name string,
        creator string, createdAt time.Time,
) Category <span class="cov8" title="1">{
        return Category{
                ID:        uuid.NewString(),
                Code:      code,
                Name:      name,
                CreatedAt: createdAt,
                CreatedBy: creator,
                UpdatedAt: createdAt,
                UpdatedBy: creator,
        }
}</span>

func ModifyProductCategory(name string, modifier string, updatedAt time.Time) Category <span class="cov8" title="1">{
        return Category{
                Name:      name,
                UpdatedAt: updatedAt,
                UpdatedBy: modifier,
        }
}</span>
</pre>
		
		<pre class="file" id="file49" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        category "AltaStore/business/category"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// DeleteCategory provides a mock function with given fields: id, adminId
func (_m *Repository) DeleteCategory(id string, adminId string) error <span class="cov8" title="1">{
        ret := _m.Called(id, adminId)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, adminId)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// FindCategoryByCode provides a mock function with given fields: id
func (_m *Repository) FindCategoryByCode(id string) (*category.Category, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *category.Category
        if rf, ok := ret.Get(0).(func(string) *category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*category.Category)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindCategoryById provides a mock function with given fields: id
func (_m *Repository) FindCategoryById(id string) (*category.Category, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *category.Category
        if rf, ok := ret.Get(0).(func(string) *category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*category.Category)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetAllCategory provides a mock function with given fields:
func (_m *Repository) GetAllCategory() (*[]category.Category, error) <span class="cov8" title="1">{
        ret := _m.Called()

        var r0 *[]category.Category
        if rf, ok := ret.Get(0).(func() *[]category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]category.Category)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertCategory provides a mock function with given fields: _a0
func (_m *Repository) InsertCategory(_a0 category.Category) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(category.Category) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateCategory provides a mock function with given fields: id, _a1
func (_m *Repository) UpdateCategory(id string, _a1 category.Category) error <span class="cov8" title="1">{
        ret := _m.Called(id, _a1)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, category.Category) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, _a1)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file50" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        category "AltaStore/business/category"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeleteCategory provides a mock function with given fields: id, deleter
func (_m *Service) DeleteCategory(id string, deleter string) error <span class="cov0" title="0">{
        ret := _m.Called(id, deleter)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, deleter)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// FindCategoryByCode provides a mock function with given fields: id
func (_m *Service) FindCategoryByCode(id string) (*category.Category, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *category.Category
        if rf, ok := ret.Get(0).(func(string) *category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*category.Category)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// FindCategoryById provides a mock function with given fields: id
func (_m *Service) FindCategoryById(id string) (*category.Category, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *category.Category
        if rf, ok := ret.Get(0).(func(string) *category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*category.Category)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAllCategory provides a mock function with given fields:
func (_m *Service) GetAllCategory() (*[]category.Category, error) <span class="cov0" title="0">{
        ret := _m.Called()

        var r0 *[]category.Category
        if rf, ok := ret.Get(0).(func() *[]category.Category); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]category.Category)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// InsertCategory provides a mock function with given fields: _a0, creator
func (_m *Service) InsertCategory(_a0 *category.CategorySpec, creator string) error <span class="cov0" title="0">{
        ret := _m.Called(_a0, creator)

        var r0 error
        if rf, ok := ret.Get(0).(func(*category.CategorySpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0, creator)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateCategory provides a mock function with given fields: id, _a1, modifier
func (_m *Service) UpdateCategory(id string, _a1 *category.CategorySpec, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, _a1, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, *category.CategorySpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, _a1, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}
</pre>
		
		<pre class="file" id="file51" style="display: none">package category

import (
        "AltaStore/business"
        "AltaStore/business/admin"
        "time"
)

type CategorySpec struct {
        AdminId string
        Code    string
        Name    string
}

type service struct {
        adminService admin.Service
        repository   Repository
}

func NewService(adminService admin.Service, repository Repository) Service <span class="cov8" title="1">{
        return &amp;service{adminService, repository}
}</span>

func (s *service) GetAllCategory() (*[]Category, error) <span class="cov8" title="1">{
        return s.repository.GetAllCategory()
}</span>

func (s *service) FindCategoryById(id string) (*Category, error) <span class="cov8" title="1">{
        return s.repository.FindCategoryById(id)
}</span>

func (s *service) FindCategoryByCode(code string) (*Category, error) <span class="cov8" title="1">{
        return s.repository.FindCategoryByCode(code)
}</span>

func (s *service) InsertCategory(category *CategorySpec, creator string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(creator)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>

        <span class="cov8" title="1">data, _ := s.repository.FindCategoryByCode(category.Code)
        if data != nil </span><span class="cov8" title="1">{
                return business.ErrDataExists
        }</span>

        <span class="cov8" title="1">dataCategory := NewProductCategory(
                category.Code, category.Name, admin.ID, time.Now(),
        )
        return s.repository.InsertCategory(dataCategory)</span>
}

func (s *service) UpdateCategory(id string, category *CategorySpec, modifier string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(modifier)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">dataCategory := ModifyProductCategory(category.Name, admin.ID, time.Now())

        return s.repository.UpdateCategory(id, dataCategory)</span>
}

func (s *service) DeleteCategory(id string, deleter string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(deleter)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">return s.repository.DeleteCategory(id, admin.ID)</span>
}
</pre>
		
		<pre class="file" id="file52" style="display: none">package checkout

import (
        "AltaStore/modules/shoppingdetail"
        "time"

        "github.com/google/uuid"
)

type Checkout struct {
        ID             string
        ShoppingCardId string
        Description    string
        CreatedBy      string
        CreatedAt      time.Time
        UpdatedAt      time.Time
}

func (c *Checkout) toCheckout() *Checkout <span class="cov8" title="1">{
        c.ID = uuid.NewString()
        c.CreatedAt = time.Now()
        c.UpdatedAt = time.Now()

        return c
}</span>

type ItemInCart struct {
        ID          string
        ProductId   string
        ProductName string
        Price       int
        Qty         int
        UpdatedAt   time.Time
}

type CheckItemDetails struct {
        ID             string
        ShoppingCardId string
        Description    string
        CreatedBy      string
        CreatedAt      time.Time
        UpdatedAt      time.Time
        Details        []ItemInCart
}

func toItem(item shoppingdetail.ShopCartDetailItemWithProductName) ItemInCart <span class="cov8" title="1">{
        return ItemInCart{
                ID:          item.ID,
                ProductId:   item.ProductId,
                ProductName: item.ProductName,
                Price:       item.Price,
                Qty:         item.Qty,
                UpdatedAt:   item.UpdatedAt,
        }
}</span>

func toDetailItemInCart(items *[]shoppingdetail.ShopCartDetailItemWithProductName) *[]ItemInCart <span class="cov8" title="1">{
        var details []ItemInCart

        for _, item := range *items </span><span class="cov8" title="1">{
                details = append(details, toItem(item))
        }</span>

        <span class="cov8" title="1">if details == nil </span><span class="cov0" title="0">{
                details = []ItemInCart{}
        }</span>

        <span class="cov8" title="1">return &amp;details</span>
}

func getCheckItemsDetails(cinfo *Checkout, items *[]ItemInCart) *CheckItemDetails <span class="cov8" title="1">{
        return &amp;CheckItemDetails{
                ID:             cinfo.ID,
                ShoppingCardId: cinfo.ShoppingCardId,
                Description:    cinfo.Description,
                CreatedBy:      cinfo.CreatedBy,
                CreatedAt:      cinfo.CreatedAt,
                UpdatedAt:      cinfo.UpdatedAt,
                Details:        *items,
        }
}</span>
</pre>
		
		<pre class="file" id="file53" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        shoppingdetail "AltaStore/modules/shoppingdetail"

        mock "github.com/stretchr/testify/mock"
)

// RepoShoppingDetail is an autogenerated mock type for the RepoShoppingDetail type
type RepoShoppingDetail struct {
        mock.Mock
}

// GetShopCartDetailById provides a mock function with given fields: id
func (_m *RepoShoppingDetail) GetShopCartDetailById(id string) (*[]shoppingdetail.ShopCartDetailItemWithProductName, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *[]shoppingdetail.ShopCartDetailItemWithProductName
        if rf, ok := ret.Get(0).(func(string) *[]shoppingdetail.ShopCartDetailItemWithProductName); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]shoppingdetail.ShopCartDetailItemWithProductName)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file54" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        checkout "AltaStore/business/checkout"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// GetAllCheckout provides a mock function with given fields:
func (_m *Repository) GetAllCheckout() (*[]checkout.Checkout, error) <span class="cov8" title="1">{
        ret := _m.Called()

        var r0 *[]checkout.Checkout
        if rf, ok := ret.Get(0).(func() *[]checkout.Checkout); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]checkout.Checkout)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetCheckoutById provides a mock function with given fields: id
func (_m *Repository) GetCheckoutById(id string) (*checkout.Checkout, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *checkout.Checkout
        if rf, ok := ret.Get(0).(func(string) *checkout.Checkout); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*checkout.Checkout)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// NewCheckoutShoppingCart provides a mock function with given fields: _a0
func (_m *Repository) NewCheckoutShoppingCart(_a0 *checkout.Checkout) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(*checkout.Checkout) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file55" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        checkout "AltaStore/business/checkout"

        mock "github.com/stretchr/testify/mock"

        snap "github.com/midtrans/midtrans-go/snap"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// GetAllCheckout provides a mock function with given fields:
func (_m *Service) GetAllCheckout() (*[]checkout.Checkout, error) <span class="cov0" title="0">{
        ret := _m.Called()

        var r0 *[]checkout.Checkout
        if rf, ok := ret.Get(0).(func() *[]checkout.Checkout); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]checkout.Checkout)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetCheckoutById provides a mock function with given fields: id
func (_m *Service) GetCheckoutById(id string) (*checkout.CheckItemDetails, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *checkout.CheckItemDetails
        if rf, ok := ret.Get(0).(func(string) *checkout.CheckItemDetails); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*checkout.CheckItemDetails)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// NewCheckoutShoppingCart provides a mock function with given fields: _a0
func (_m *Service) NewCheckoutShoppingCart(_a0 *checkout.Checkout) (*snap.Response, error) <span class="cov0" title="0">{
        ret := _m.Called(_a0)

        var r0 *snap.Response
        if rf, ok := ret.Get(0).(func(*checkout.Checkout) *snap.Response); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*snap.Response)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(*checkout.Checkout) error); ok </span><span class="cov0" title="0">{
                r1 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file56" style="display: none">package checkout

import (
        "AltaStore/business/checkoutpayment"

        snap "github.com/midtrans/midtrans-go/snap"
)

type service struct {
        checkoutpaymentService checkoutpayment.Service
        repository             Repository
        repoShoppingDetail     RepoShoppingDetail
}

func NewService(
        checkoutpaymentService checkoutpayment.Service,
        repository Repository,
        repoShoppingDetail RepoShoppingDetail,

) Service <span class="cov8" title="1">{
        return &amp;service{
                checkoutpaymentService,
                repository,
                repoShoppingDetail,
        }
}</span>

func (s *service) NewCheckoutShoppingCart(checkout *Checkout) (*snap.Response, error) <span class="cov8" title="1">{
        var newCheckout = checkout.toCheckout()
        dets, err := s.repoShoppingDetail.GetShopCartDetailById(newCheckout.ShoppingCardId)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">err = s.repository.NewCheckoutShoppingCart(newCheckout)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">var sum int64 = 0
        for _, val := range *dets </span><span class="cov8" title="1">{
                sum += int64(val.Qty)
        }</span>

        <span class="cov8" title="1">return s.checkoutpaymentService.GenerateSnapPayment(
                newCheckout.CreatedBy,
                newCheckout.ID,
                sum)</span>
}

func (s *service) GetAllCheckout() (*[]Checkout, error) <span class="cov8" title="1">{
        return s.repository.GetAllCheckout()
}</span>

func (s *service) GetCheckoutById(id string) (*CheckItemDetails, error) <span class="cov8" title="1">{
        dtCheckout, err := s.repository.GetCheckoutById(id)

        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">items, err := s.repoShoppingDetail.GetShopCartDetailById(dtCheckout.ShoppingCardId)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">details := toDetailItemInCart(items)

        return getCheckItemsDetails(dtCheckout, details), nil</span>
}
</pre>
		
		<pre class="file" id="file57" style="display: none">package checkoutpayment

import (
        "time"
)

type PaymentStatus string

const (
        Pending     PaymentStatus = "pending"
        Capture     PaymentStatus = "captured"
        Settlement  PaymentStatus = "settlement"
        DenyPayment PaymentStatus = "deny"
        Cancel      PaymentStatus = "cancel"
        Expire      PaymentStatus = "expire"
        Failure     PaymentStatus = "failure"
)

type FraudStatus string

const (
        None      FraudStatus = ""
        Accept    FraudStatus = "accept"
        Deny      FraudStatus = "deny"
        Challenge FraudStatus = "challenge"
)

type CheckoutPayment struct {
        CheckOutID        string
        MerchantId        string
        StatusCode        string
        TransactionStatus PaymentStatus
        FraudStatus       FraudStatus
        CreatedAt         time.Time
        CreatedBy         string
        UpdatedAt         time.Time
        UpdatedBy         string
        DeletedAt         time.Time
        DeletedBy         string
}

func InsertPayment(
        checkoutId string,
        statusCode string,
        merchantId string,
        transactionstatus string,
        fraudstatus string,
        creator string,
        createAt time.Time,
) CheckoutPayment <span class="cov8" title="1">{
        return CheckoutPayment{
                CheckOutID:        checkoutId,
                MerchantId:        merchantId,
                StatusCode:        statusCode,
                TransactionStatus: PaymentStatus(transactionstatus),
                FraudStatus:       FraudStatus(fraudstatus),
                CreatedAt:         createAt,
                CreatedBy:         creator,
        }
}</span>

// func (oldData *CheckoutPayment) ModifyPayment(
//         merchantId string,
//         transactionstatus string,
//         fraudstatus string,
//         modifier string,
//         updatedAt time.Time,
// ) CheckoutPayment {
//         return CheckoutPayment{
//                 CheckOutID:        oldData.CheckOutID,
//                 MerchantId:        merchantId,
//                 TransactionStatus: PaymentStatus(transactionstatus),
//                 FraudStatus:       FraudStatus(fraudstatus),
//                 CreatedAt:         oldData.CreatedAt,
//                 CreatedBy:         oldData.CreatedBy,
//                 UpdatedAt:         updatedAt,
//                 UpdatedBy:         modifier,
//         }
// }
</pre>
		
		<pre class="file" id="file58" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        checkoutpayment "AltaStore/business/checkoutpayment"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// InsertPayment provides a mock function with given fields: payment
func (_m *Repository) InsertPayment(payment *checkoutpayment.CheckoutPayment) (*checkoutpayment.CheckoutPayment, error) <span class="cov8" title="1">{
        ret := _m.Called(payment)

        var r0 *checkoutpayment.CheckoutPayment
        if rf, ok := ret.Get(0).(func(*checkoutpayment.CheckoutPayment) *checkoutpayment.CheckoutPayment); ok </span><span class="cov0" title="0">{
                r0 = rf(payment)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*checkoutpayment.CheckoutPayment)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(*checkoutpayment.CheckoutPayment) error); ok </span><span class="cov0" title="0">{
                r1 = rf(payment)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file59" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        checkoutpayment "AltaStore/business/checkoutpayment"

        mock "github.com/stretchr/testify/mock"

        snap "github.com/midtrans/midtrans-go/snap"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// GenerateSnapPayment provides a mock function with given fields: customerId, checkoutId, amount
func (_m *Service) GenerateSnapPayment(customerId string, checkoutId string, amount int64) (*snap.Response, error) <span class="cov8" title="1">{
        ret := _m.Called(customerId, checkoutId, amount)

        var r0 *snap.Response
        if rf, ok := ret.Get(0).(func(string, string, int64) *snap.Response); ok </span><span class="cov0" title="0">{
                r0 = rf(customerId, checkoutId, amount)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*snap.Response)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string, int64) error); ok </span><span class="cov0" title="0">{
                r1 = rf(customerId, checkoutId, amount)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertPayment provides a mock function with given fields: payment
func (_m *Service) InsertPayment(payment *checkoutpayment.InserPaymentSpec) (*checkoutpayment.InserPaymentSpec, error) <span class="cov0" title="0">{
        ret := _m.Called(payment)

        var r0 *checkoutpayment.InserPaymentSpec
        if rf, ok := ret.Get(0).(func(*checkoutpayment.InserPaymentSpec) *checkoutpayment.InserPaymentSpec); ok </span><span class="cov0" title="0">{
                r0 = rf(payment)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*checkoutpayment.InserPaymentSpec)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(*checkoutpayment.InserPaymentSpec) error); ok </span><span class="cov0" title="0">{
                r1 = rf(payment)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file60" style="display: none">package checkoutpayment

import (
        "AltaStore/business"
        "AltaStore/business/user"
        "AltaStore/config"
        "time"

        midtrans "github.com/midtrans/midtrans-go"
        snap "github.com/midtrans/midtrans-go/snap"
)

type InserPaymentSpec struct {
        OrderId           string `validate:"required"`
        MerchantId        string
        StatusCode        string `validate:"required"`
        TransactionStatus string `validate:"required"`
        FraudStatus       string
}

type service struct {
        userService user.Service
        repository  Repository
}

func NewService(userService user.Service, repository Repository) Service <span class="cov8" title="1">{
        return &amp;service{userService, repository}
}</span>

func (s *service) GenerateSnapPayment(customerId string, checkoutId string, amount int64) (*snap.Response, error) <span class="cov0" title="0">{
        // 1. Initiate Snap client
        var sc snap.Client
        var key = config.GetConfig().MidTransServerKey
        sc.New(key, midtrans.Sandbox)
        // Use to midtrans.Production if you want Production Environment (accept real transaction).

        user, err := s.userService.FindUserByID(customerId)
        if err != nil </span><span class="cov0" title="0">{
                var res snap.Response
                return &amp;res, business.ErrNotFound
        }</span>
        // 2. Initiate Snap request param
        <span class="cov0" title="0">req := &amp;snap.Request{
                TransactionDetails: midtrans.TransactionDetails{
                        OrderID:  checkoutId,
                        GrossAmt: amount,
                },
                CreditCard: &amp;snap.CreditCardDetails{
                        Secure: true,
                },
                CustomerDetail: &amp;midtrans.CustomerDetails{
                        FName: user.FirstName,
                        LName: user.LastName,
                        Email: user.Email,
                        Phone: user.HandPhone,
                },
        }

        // 3. Execute request create Snap transaction to Midtrans Snap API
        snapResp, midtransErr := sc.CreateTransaction(req)
        if midtransErr != nil </span><span class="cov0" title="0">{
                return snapResp, business.ErrNotFound
        }</span>
        <span class="cov0" title="0">return snapResp, nil</span>
}

func (s *service) InsertPayment(p *InserPaymentSpec) (*InserPaymentSpec, error) <span class="cov8" title="1">{

        //TODO: Check inv apakah ada

        data := InsertPayment(
                p.OrderId,
                p.StatusCode,
                p.MerchantId,
                p.TransactionStatus,
                p.FraudStatus,
                "midtrans",
                time.Now())

        _, err := s.repository.InsertPayment(&amp;data)
        if err != nil </span><span class="cov8" title="1">{
                return p, business.ErrInternalServer
        }</span>
        <span class="cov8" title="1">return p, nil</span>
}
</pre>
		
		<pre class="file" id="file61" style="display: none">package logger

import "encoding/json"

type service struct {
        repository Repository
}

func NewService(repository Repository) Service <span class="cov0" title="0">{
        return &amp;service{repository}
}</span>

func (s *service) Write(p []byte) (n int, err error) <span class="cov0" title="0">{
        var data LoggerData

        json.Unmarshal(p, &amp;data)

        return len(p), s.repository.AddLoggerActivity(&amp;data)
}</span>
</pre>
		
		<pre class="file" id="file62" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        product "AltaStore/business/product"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// DeleteProduct provides a mock function with given fields: Product
func (_m *Repository) DeleteProduct(Product product.Product) error <span class="cov8" title="1">{
        ret := _m.Called(Product)

        var r0 error
        if rf, ok := ret.Get(0).(func(product.Product) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Product)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// FindProductByCode provides a mock function with given fields: code
func (_m *Repository) FindProductByCode(code string) (*product.Product, error) <span class="cov8" title="1">{
        ret := _m.Called(code)

        var r0 *product.Product
        if rf, ok := ret.Get(0).(func(string) *product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(code)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*product.Product)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(code)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindProductById provides a mock function with given fields: id
func (_m *Repository) FindProductById(id string) (*product.Product, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *product.Product
        if rf, ok := ret.Get(0).(func(string) *product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*product.Product)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetAllProduct provides a mock function with given fields:
func (_m *Repository) GetAllProduct() (*[]product.Product, error) <span class="cov8" title="1">{
        ret := _m.Called()

        var r0 *[]product.Product
        if rf, ok := ret.Get(0).(func() *[]product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]product.Product)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetAllProductByParameter provides a mock function with given fields: id, isActive, categoryName, code, name
func (_m *Repository) GetAllProductByParameter(id string, isActive string, categoryName string, code string, name string) (*[]product.Product, error) <span class="cov8" title="1">{
        ret := _m.Called(id, isActive, categoryName, code, name)

        var r0 *[]product.Product
        if rf, ok := ret.Get(0).(func(string, string, string, string, string) *[]product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(id, isActive, categoryName, code, name)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]product.Product)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string, string, string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id, isActive, categoryName, code, name)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertProduct provides a mock function with given fields: Product
func (_m *Repository) InsertProduct(Product product.Product) error <span class="cov8" title="1">{
        ret := _m.Called(Product)

        var r0 error
        if rf, ok := ret.Get(0).(func(product.Product) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Product)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateProduct provides a mock function with given fields: Product
func (_m *Repository) UpdateProduct(Product product.Product) error <span class="cov8" title="1">{
        ret := _m.Called(Product)

        var r0 error
        if rf, ok := ret.Get(0).(func(product.Product) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Product)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file63" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        product "AltaStore/business/product"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeleteProduct provides a mock function with given fields: id, deleter
func (_m *Service) DeleteProduct(id string, deleter string) error <span class="cov0" title="0">{
        ret := _m.Called(id, deleter)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, deleter)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// FindProductByCode provides a mock function with given fields: code
func (_m *Service) FindProductByCode(code string) (*product.Product, error) <span class="cov0" title="0">{
        ret := _m.Called(code)

        var r0 *product.Product
        if rf, ok := ret.Get(0).(func(string) *product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(code)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*product.Product)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(code)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// FindProductById provides a mock function with given fields: id
func (_m *Service) FindProductById(id string) (*product.Product, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *product.Product
        if rf, ok := ret.Get(0).(func(string) *product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*product.Product)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAllProduct provides a mock function with given fields:
func (_m *Service) GetAllProduct() (*[]product.Product, error) <span class="cov0" title="0">{
        ret := _m.Called()

        var r0 *[]product.Product
        if rf, ok := ret.Get(0).(func() *[]product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]product.Product)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAllProductByParameter provides a mock function with given fields: id, isActive, categoryName, code, name
func (_m *Service) GetAllProductByParameter(id string, isActive string, categoryName string, code string, name string) (*[]product.Product, error) <span class="cov0" title="0">{
        ret := _m.Called(id, isActive, categoryName, code, name)

        var r0 *[]product.Product
        if rf, ok := ret.Get(0).(func(string, string, string, string, string) *[]product.Product); ok </span><span class="cov0" title="0">{
                r0 = rf(id, isActive, categoryName, code, name)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]product.Product)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string, string, string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id, isActive, categoryName, code, name)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// InsertProduct provides a mock function with given fields: Product, creator
func (_m *Service) InsertProduct(Product *product.InsertProductSpec, creator string) error <span class="cov0" title="0">{
        ret := _m.Called(Product, creator)

        var r0 error
        if rf, ok := ret.Get(0).(func(*product.InsertProductSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(Product, creator)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateProduct provides a mock function with given fields: id, Product, modifier
func (_m *Service) UpdateProduct(id string, Product *product.UpdateProductSpec, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, Product, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, *product.UpdateProductSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, Product, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}
</pre>
		
		<pre class="file" id="file64" style="display: none">package product

import (
        "time"

        "github.com/google/uuid"
)

// Membuat core data pada domain bisnis
type Product struct {
        ID                  string
        Code                string
        Name                string
        Price               int64
        Qty                 int32
        QtyCart             int32
        IsActive            bool
        ProductCategoryId   string
        ProductCategoryName string
        UnitName            string
        Description         string
        CreatedAt           time.Time
        CreatedBy           string
        UpdatedAt           time.Time
        UpdatedBy           string
        DeletedAt           time.Time
        DeletedBy           string
}

func NewProduct(
        code string,
        name string,
        price int64,
        isActive bool,
        productCategoryId string,
        unitName string,
        description string,
        creator string,
        createdAt time.Time,
) Product <span class="cov8" title="1">{
        return Product{
                ID:                uuid.NewString(),
                Code:              code,
                Name:              name,
                Price:             price,
                IsActive:          isActive,
                ProductCategoryId: productCategoryId,
                UnitName:          unitName,
                Description:       description,
                CreatedAt:         createdAt,
                CreatedBy:         creator,
                UpdatedAt:         createdAt,
                UpdatedBy:         creator,
        }
}</span>

func (oldData *Product) ModifyProduct(
        name string,
        price int64,
        isActive bool,
        productCategoryId string,
        unitName string,
        description string,
        modifier string,
        updatedAt time.Time,
) Product <span class="cov8" title="1">{
        return Product{
                ID:                oldData.ID,
                Code:              oldData.Code,
                Name:              name,
                Price:             price,
                IsActive:          isActive,
                ProductCategoryId: productCategoryId,
                UnitName:          unitName,
                Description:       description,
                CreatedAt:         oldData.CreatedAt,
                CreatedBy:         oldData.CreatedBy,
                UpdatedAt:         updatedAt,
                UpdatedBy:         modifier,
        }
}</span>

func (oldData *Product) DeleteProduct(
        deleteAt time.Time,
        deleter string) Product <span class="cov8" title="1">{

        return Product{
                ID:                oldData.ID,
                Code:              oldData.Code,
                Name:              oldData.Name,
                Price:             oldData.Price,
                IsActive:          oldData.IsActive,
                ProductCategoryId: oldData.ProductCategoryId,
                UnitName:          oldData.UnitName,
                Description:       oldData.Description,
                CreatedAt:         oldData.CreatedAt,
                CreatedBy:         oldData.CreatedBy,
                UpdatedAt:         oldData.UpdatedAt,
                UpdatedBy:         oldData.UpdatedBy,
                DeletedAt:         deleteAt,
                DeletedBy:         deleter,
        }
}</span>
</pre>
		
		<pre class="file" id="file65" style="display: none">package product

import (
        "AltaStore/business"
        "AltaStore/business/admin"
        "AltaStore/util/validator"
        "time"
)

type InsertProductSpec struct {
        Code              string `validate:"required"`
        Name              string `validate:"required"`
        Price             int64  `validate:"required"`
        IsActive          bool
        ProductCategoryId string `validate:"required"`
        UnitName          string `validate:"required"`
        Description       string
}

type UpdateProductSpec struct {
        Name              string `validate:"required"`
        Price             int64  `validate:"required"`
        IsActive          bool   `validate:"required"`
        ProductCategoryId string `validate:"required"`
        UnitName          string `validate:"required"`
        Description       string
}

type service struct {
        adminService admin.Service
        repository   Repository
}

func NewService(adminService admin.Service, repository Repository) Service <span class="cov8" title="1">{
        return &amp;service{adminService, repository}
}</span>

func (s *service) GetAllProduct() (*[]Product, error) <span class="cov8" title="1">{
        return s.repository.GetAllProduct()
}</span>

func (s *service) GetAllProductByParameter(id, isActive, categoryName, code, name string) (*[]Product, error) <span class="cov8" title="1">{
        return s.repository.GetAllProductByParameter(id, isActive, categoryName, code, name)
}</span>

func (s *service) FindProductById(id string) (*Product, error) <span class="cov8" title="1">{
        return s.repository.FindProductById(id)
}</span>

func (s *service) FindProductByCode(code string) (*Product, error) <span class="cov8" title="1">{
        return s.repository.FindProductByCode(code)
}</span>

func (s *service) InsertProduct(product *InsertProductSpec, creator string) error <span class="cov8" title="1">{
        err := validator.GetValidator().Struct(product)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>
        <span class="cov8" title="1">admin, err := s.adminService.FindAdminByID(creator)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">dataproduct, _ := s.repository.FindProductByCode(product.Code)
        if dataproduct != nil </span><span class="cov8" title="1">{
                return business.ErrDataExists
        }</span>
        <span class="cov8" title="1">data := NewProduct(
                product.Code,
                product.Name,
                product.Price,
                product.IsActive,
                product.ProductCategoryId,
                product.UnitName,
                product.Description,
                admin.ID,
                time.Now(),
        )
        return s.repository.InsertProduct(data)</span>
}

func (s *service) UpdateProduct(id string, updateProduct *UpdateProductSpec, modifier string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(modifier)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">product, err := s.repository.FindProductById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if product == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if product.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>
        <span class="cov8" title="1">err = validator.GetValidator().Struct(product)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>

        <span class="cov8" title="1">modifiedproduct := product.ModifyProduct(
                updateProduct.Name,
                updateProduct.Price,
                updateProduct.IsActive,
                updateProduct.ProductCategoryId,
                updateProduct.UnitName,
                updateProduct.Description,
                admin.ID,
                time.Now())

        return s.repository.UpdateProduct(modifiedproduct)</span>
}

func (s *service) DeleteProduct(id string, deleter string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(deleter)
        if err != nil </span><span class="cov8" title="1">{
                return business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">product, err := s.repository.FindProductById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if product == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if product.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>
        <span class="cov8" title="1">deleteProduct := product.DeleteProduct(
                time.Now(),
                admin.ID,
        )
        return s.repository.DeleteProduct(deleteProduct)</span>
}
</pre>
		
		<pre class="file" id="file66" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        purchasereceiving "AltaStore/business/purchasereceiving"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// DeletePurchaseReceiving provides a mock function with given fields: item
func (_m *Repository) DeletePurchaseReceiving(item *purchasereceiving.PurchaseReceiving) error <span class="cov8" title="1">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceiving) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// GetAllPurchaseReceiving provides a mock function with given fields:
func (_m *Repository) GetAllPurchaseReceiving() (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov8" title="1">{
        ret := _m.Called()

        var r0 *[]purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func() *[]purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf()
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func() error); ok </span><span class="cov0" title="0">{
                r1 = rf()
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetAllPurchaseReceivingByParameter provides a mock function with given fields: code
func (_m *Repository) GetAllPurchaseReceivingByParameter(code string) (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov8" title="1">{
        ret := _m.Called(code)

        var r0 *[]purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func(string) *[]purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf(code)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(code)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetPurchaseReceivingById provides a mock function with given fields: id
func (_m *Repository) GetPurchaseReceivingById(id string) (*purchasereceiving.PurchaseReceiving, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func(string) *purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertPurchaseReceiving provides a mock function with given fields: item
func (_m *Repository) InsertPurchaseReceiving(item *purchasereceiving.PurchaseReceiving) error <span class="cov8" title="1">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceiving) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdatePurchaseReceiving provides a mock function with given fields: item
func (_m *Repository) UpdatePurchaseReceiving(item *purchasereceiving.PurchaseReceiving) error <span class="cov8" title="1">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceiving) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file67" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        purchasereceiving "AltaStore/business/purchasereceiving"

        mock "github.com/stretchr/testify/mock"
)

// RepositoryDetail is an autogenerated mock type for the RepositoryDetail type
type RepositoryDetail struct {
        mock.Mock
}

// DeletePurchaseReceivingDetail provides a mock function with given fields: item
func (_m *RepositoryDetail) DeletePurchaseReceivingDetail(item *purchasereceiving.PurchaseReceivingDetail) error <span class="cov0" title="0">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceivingDetail) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// GetPurchaseReceivingDetailById provides a mock function with given fields: id
func (_m *RepositoryDetail) GetPurchaseReceivingDetailById(id string) (*purchasereceiving.PurchaseReceivingDetail, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *purchasereceiving.PurchaseReceivingDetail
        if rf, ok := ret.Get(0).(func(string) *purchasereceiving.PurchaseReceivingDetail); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*purchasereceiving.PurchaseReceivingDetail)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetPurchaseReceivingDetailByPurchaseReceivingId provides a mock function with given fields: id
func (_m *RepositoryDetail) GetPurchaseReceivingDetailByPurchaseReceivingId(id string) (*[]purchasereceiving.PurchaseReceivingDetail, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *[]purchasereceiving.PurchaseReceivingDetail
        if rf, ok := ret.Get(0).(func(string) *[]purchasereceiving.PurchaseReceivingDetail); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]purchasereceiving.PurchaseReceivingDetail)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// InsertPurchaseReceivingDetail provides a mock function with given fields: item
func (_m *RepositoryDetail) InsertPurchaseReceivingDetail(item *purchasereceiving.PurchaseReceivingDetail) error <span class="cov8" title="1">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceivingDetail) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdatePurchaseReceivingDetail provides a mock function with given fields: item
func (_m *RepositoryDetail) UpdatePurchaseReceivingDetail(item *purchasereceiving.PurchaseReceivingDetail) error <span class="cov8" title="1">{
        ret := _m.Called(item)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.PurchaseReceivingDetail) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file68" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        purchasereceiving "AltaStore/business/purchasereceiving"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeletePurchaseReceiving provides a mock function with given fields: id, deleter
func (_m *Service) DeletePurchaseReceiving(id string, deleter string) error <span class="cov0" title="0">{
        ret := _m.Called(id, deleter)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, deleter)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// GetAllPurchaseReceiving provides a mock function with given fields: finder
func (_m *Service) GetAllPurchaseReceiving(finder string) (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        ret := _m.Called(finder)

        var r0 *[]purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func(string) *[]purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf(finder)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(finder)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAllPurchaseReceivingByParameter provides a mock function with given fields: code, finder
func (_m *Service) GetAllPurchaseReceivingByParameter(code string, finder string) (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        ret := _m.Called(code, finder)

        var r0 *[]purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func(string, string) *[]purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf(code, finder)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*[]purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(code, finder)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetPurchaseReceivingById provides a mock function with given fields: id, finder
func (_m *Service) GetPurchaseReceivingById(id string, finder string) (*purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        ret := _m.Called(id, finder)

        var r0 *purchasereceiving.PurchaseReceiving
        if rf, ok := ret.Get(0).(func(string, string) *purchasereceiving.PurchaseReceiving); ok </span><span class="cov0" title="0">{
                r0 = rf(id, finder)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*purchasereceiving.PurchaseReceiving)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id, finder)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// InsertPurchaseReceiving provides a mock function with given fields: item, creator
func (_m *Service) InsertPurchaseReceiving(item *purchasereceiving.InsertPurchaseReceivingSpec, creator string) error <span class="cov0" title="0">{
        ret := _m.Called(item, creator)

        var r0 error
        if rf, ok := ret.Get(0).(func(*purchasereceiving.InsertPurchaseReceivingSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(item, creator)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdatePurchaseReceiving provides a mock function with given fields: id, item, modifier
func (_m *Service) UpdatePurchaseReceiving(id string, item *purchasereceiving.UpdatePurchaseReceivingSpec, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, item, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, *purchasereceiving.UpdatePurchaseReceivingSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, item, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}
</pre>
		
		<pre class="file" id="file69" style="display: none">package purchasereceiving

import (
        "time"

        "github.com/google/uuid"
)

type PurchaseReceiving struct {
        ID           string
        Code         string
        DateReceived time.Time
        ReceivedBy   string
        Description  string
        Details      []*PurchaseReceivingDetail
        CreatedBy    string
        CreatedAt    time.Time
        UpdatedBy    string
        UpdatedAt    time.Time
        DeletedBy    string
        DeletedAt    time.Time
}

type PurchaseReceivingDetail struct {
        ID                  string
        PurchaseReceivingId string
        ProductId           string
        Qty                 int32
        Price               int64
        CreatedBy           string
        CreatedAt           time.Time
        UpdatedBy           string
        UpdatedAt           time.Time
        DeletedBy           string
        DeletedAt           time.Time
}

func NewPurchaseReceiving(
        newCode string,
        newDateReceived time.Time,
        newReceivedBy string,
        newDescription string,
        creator string,
        createdAt time.Time,
) PurchaseReceiving <span class="cov8" title="1">{
        return PurchaseReceiving{
                ID:           uuid.NewString(),
                Code:         newCode,
                DateReceived: newDateReceived,
                ReceivedBy:   newReceivedBy,
                Description:  newDescription,
                CreatedAt:    createdAt,
                CreatedBy:    creator,
        }
}</span>

func NewPurchaseReceivingDetail(
        purchaseReceivingId string,
        newProductId string,
        newQty int32,
        newPrice int64,
        creator string,
        createdAt time.Time,
) PurchaseReceivingDetail <span class="cov8" title="1">{
        return PurchaseReceivingDetail{
                ID:                  uuid.NewString(),
                PurchaseReceivingId: purchaseReceivingId,
                ProductId:           newProductId,
                Qty:                 newQty,
                Price:               newPrice,
                CreatedBy:           creator,
                CreatedAt:           createdAt,
        }
}</span>

func (oldData *PurchaseReceiving) ModifyPurchaseReceiving(
        newCode string,
        newDateReceived time.Time,
        newReceivedBy string,
        newDescription string,
        modifier string,
        modifierAt time.Time,
) PurchaseReceiving <span class="cov8" title="1">{
        return PurchaseReceiving{
                ID:           oldData.ID,
                Code:         newCode,
                DateReceived: newDateReceived,
                ReceivedBy:   newReceivedBy,
                Description:  newDescription,
                CreatedAt:    oldData.CreatedAt,
                CreatedBy:    oldData.CreatedBy,
                UpdatedAt:    modifierAt,
                UpdatedBy:    modifier,
        }
}</span>

func (oldData *PurchaseReceivingDetail) ModifyPurchaseReceivingDetail(
        newProductId string,
        newQty int32,
        newPrice int64,
        modifier string,
        modifierAt time.Time,
) PurchaseReceivingDetail <span class="cov8" title="1">{
        return PurchaseReceivingDetail{
                ID:        oldData.ID,
                ProductId: newProductId,
                Qty:       newQty,
                Price:     newPrice,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: modifierAt,
                UpdatedBy: modifier,
        }
}</span>

func (oldData *PurchaseReceiving) DeletePurchaseReceiving(
        deleter string,
        deletedAt time.Time,
) PurchaseReceiving <span class="cov8" title="1">{
        return PurchaseReceiving{
                ID:           oldData.ID,
                Code:         oldData.Code,
                DateReceived: oldData.DateReceived,
                ReceivedBy:   oldData.ReceivedBy,
                Description:  oldData.Description,
                CreatedAt:    oldData.CreatedAt,
                CreatedBy:    oldData.CreatedBy,
                UpdatedAt:    oldData.UpdatedAt,
                UpdatedBy:    oldData.UpdatedBy,
                DeletedAt:    deletedAt,
                DeletedBy:    deleter,
        }
}</span>

func (oldData *PurchaseReceivingDetail) DeletePurchaseReceivingDetail(
        deleter string,
        deletedAt time.Time,
) PurchaseReceivingDetail <span class="cov0" title="0">{
        return PurchaseReceivingDetail{
                ID:        oldData.ID,
                ProductId: oldData.ProductId,
                Qty:       oldData.Qty,
                Price:     oldData.Price,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: oldData.UpdatedAt,
                UpdatedBy: oldData.UpdatedBy,
                DeletedAt: deletedAt,
                DeletedBy: deleter,
        }
}</span>
</pre>
		
		<pre class="file" id="file70" style="display: none">package purchasereceiving

import (
        "AltaStore/business"
        "AltaStore/business/admin"
        "AltaStore/util/validator"
        "time"
)

type InsertPurchaseReceivingSpec struct {
        Code         string    `validate:"required"`
        DateReceived time.Time `validate:"required"`
        ReceivedBy   string    `validate:"required"`
        Description  string
        Details      []InsertPurchaseReceivingDetailSpec `validate:"required"`
}

type InsertPurchaseReceivingDetailSpec struct {
        ProductId string `validate:"required"`
        Qty       int32  `validate:"required"`
        Price     int64  `validate:"required"`
}

type UpdatePurchaseReceivingSpec struct {
        Code         string    `validate:"required"`
        DateReceived time.Time `validate:"required"`
        ReceivedBy   string    `validate:"required"`
        Description  string
        Details      []UpdatePurchaseReceivingDetailSpec `validate:"required"`
}
type UpdatePurchaseReceivingDetailSpec struct {
        ID        string
        ProductId string `validate:"required"`
        Qty       int32  `validate:"required"`
        Price     int64  `validate:"required"`
        IsDelete  bool   `validate:"required"`
}

type service struct {
        adminService     admin.Service
        repository       Repository
        repositoryDetail RepositoryDetail
}

func NewService(
        adminService admin.Service,
        repository Repository,
        repositoryDetail RepositoryDetail,
) Service <span class="cov8" title="1">{
        return &amp;service{
                adminService, repository, repositoryDetail,
        }
}</span>

// GetAllPurchaseReceiving(finder string) (*PurchaseReceiving, error)
// GetAllPurchaseReceivingById(id, finder string) (*PurchaseReceiving, error)

func (s *service) GetAllPurchaseReceivingByParameter(code string, finder string) (*[]PurchaseReceiving, error) <span class="cov8" title="1">{
        _, err := s.adminService.FindAdminByID(finder)
        if err != nil </span><span class="cov0" title="0">{
                empty := []PurchaseReceiving{}
                return &amp;empty, business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">return s.repository.GetAllPurchaseReceivingByParameter(code)</span>
}

func (s *service) GetAllPurchaseReceiving(finder string) (*[]PurchaseReceiving, error) <span class="cov8" title="1">{
        _, err := s.adminService.FindAdminByID(finder)
        if err != nil </span><span class="cov0" title="0">{
                empty := []PurchaseReceiving{}
                return &amp;empty, business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">return s.repository.GetAllPurchaseReceiving()</span>
}

func (s *service) GetPurchaseReceivingById(id, finder string) (*PurchaseReceiving, error) <span class="cov8" title="1">{
        _, err := s.adminService.FindAdminByID(finder)
        if err != nil </span><span class="cov0" title="0">{
                var empty PurchaseReceiving
                return &amp;empty, business.ErrNotHavePermission
        }</span>
        <span class="cov8" title="1">return s.repository.GetPurchaseReceivingById(id)</span>
}

func (s *service) InsertPurchaseReceiving(item *InsertPurchaseReceivingSpec, creator string) error <span class="cov8" title="1">{
        err := validator.GetValidator().Struct(item)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>

        <span class="cov8" title="1">admin, err := s.adminService.FindAdminByID(creator)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrNotHavePermission
        }</span>

        <span class="cov8" title="1">newItem := NewPurchaseReceiving(
                item.Code,
                item.DateReceived,
                item.ReceivedBy,
                item.Description,
                admin.ID,
                time.Now(),
        )
        err = s.repository.InsertPurchaseReceiving(&amp;newItem)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">for _, val := range item.Details </span><span class="cov8" title="1">{
                newDetail := NewPurchaseReceivingDetail(
                        newItem.ID,
                        val.ProductId,
                        val.Qty,
                        val.Price,
                        newItem.CreatedBy,
                        newItem.CreatedAt,
                )
                err = s.repositoryDetail.InsertPurchaseReceivingDetail(&amp;newDetail)
                if err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
        }
        <span class="cov8" title="1">return nil</span>
}

func (s *service) UpdatePurchaseReceiving(id string, item *UpdatePurchaseReceivingSpec, modifier string) error <span class="cov8" title="1">{
        err := validator.GetValidator().Struct(item)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>

        <span class="cov8" title="1">admin, err := s.adminService.FindAdminByID(modifier)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrNotHavePermission
        }</span>

        <span class="cov8" title="1">purchase, err := s.repository.GetPurchaseReceivingById(id)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>

        <span class="cov8" title="1">updateData := purchase.ModifyPurchaseReceiving(
                item.Code,
                item.DateReceived,
                item.ReceivedBy,
                item.Description,
                admin.ID,
                time.Now(),
        )

        err = s.repository.UpdatePurchaseReceiving(&amp;updateData)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">for _, val := range item.Details </span><span class="cov8" title="1">{
                if val.ID == "" </span><span class="cov0" title="0">{
                        if !val.IsDelete </span><span class="cov0" title="0">{
                                newDetail := NewPurchaseReceivingDetail(
                                        purchase.ID,
                                        val.ProductId,
                                        val.Qty,
                                        val.Price,
                                        purchase.UpdatedBy,
                                        purchase.UpdatedAt,
                                )
                                err = s.repositoryDetail.InsertPurchaseReceivingDetail(&amp;newDetail)
                                if err != nil </span><span class="cov0" title="0">{
                                        return err
                                }</span>
                        }
                } else<span class="cov8" title="1"> {
                        detail, err := s.repositoryDetail.GetPurchaseReceivingDetailById(val.ID)
                        if err != nil </span><span class="cov0" title="0">{
                                return err
                        }</span>
                        <span class="cov8" title="1">if !val.IsDelete </span><span class="cov8" title="1">{
                                updateData := detail.ModifyPurchaseReceivingDetail(
                                        val.ProductId,
                                        val.Qty,
                                        val.Price,
                                        purchase.UpdatedBy,
                                        purchase.UpdatedAt,
                                )
                                err = s.repositoryDetail.UpdatePurchaseReceivingDetail(&amp;updateData)
                                if err != nil </span><span class="cov0" title="0">{
                                        return business.ErrNotFound
                                }</span>
                        } else<span class="cov0" title="0"> {
                                deleteData := detail.DeletePurchaseReceivingDetail(
                                        purchase.UpdatedBy,
                                        purchase.UpdatedAt,
                                )
                                err = s.repositoryDetail.DeletePurchaseReceivingDetail(&amp;deleteData)
                                if err != nil </span><span class="cov0" title="0">{
                                        return business.ErrNotFound
                                }</span>
                        }
                }
        }
        <span class="cov8" title="1">return nil</span>
}

func (s *service) DeletePurchaseReceiving(id string, deleter string) error <span class="cov8" title="1">{
        admin, err := s.adminService.FindAdminByID(deleter)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrNotHavePermission
        }</span>

        <span class="cov8" title="1">purchase, err := s.repository.GetPurchaseReceivingById(id)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>
        <span class="cov8" title="1">deleteData := purchase.DeletePurchaseReceiving(
                admin.ID,
                time.Now(),
        )

        return s.repository.DeletePurchaseReceiving(&amp;deleteData)</span>
}
</pre>
		
		<pre class="file" id="file71" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        shopping "AltaStore/business/shopping"

        mock "github.com/stretchr/testify/mock"

        time "time"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// GetShoppingCartById provides a mock function with given fields: id
func (_m *Repository) GetShoppingCartById(id string) (*shopping.ShoppCart, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *shopping.ShoppCart
        if rf, ok := ret.Get(0).(func(string) *shopping.ShoppCart); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*shopping.ShoppCart)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// GetShoppingCartByUserId provides a mock function with given fields: userid
func (_m *Repository) GetShoppingCartByUserId(userid string) (*shopping.ShoppCart, error) <span class="cov8" title="1">{
        ret := _m.Called(userid)

        var r0 *shopping.ShoppCart
        if rf, ok := ret.Get(0).(func(string) *shopping.ShoppCart); ok </span><span class="cov0" title="0">{
                r0 = rf(userid)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*shopping.ShoppCart)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(userid)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// NewShoppingCart provides a mock function with given fields: id, userid, description, createdAt
func (_m *Repository) NewShoppingCart(id string, userid string, description string, createdAt time.Time) (*shopping.ShoppCart, error) <span class="cov8" title="1">{
        ret := _m.Called(id, userid, description, createdAt)

        var r0 *shopping.ShoppCart
        if rf, ok := ret.Get(0).(func(string, string, string, time.Time) *shopping.ShoppCart); ok </span><span class="cov0" title="0">{
                r0 = rf(id, userid, description, createdAt)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*shopping.ShoppCart)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string, string, time.Time) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id, userid, description, createdAt)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file72" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        mock "github.com/stretchr/testify/mock"

        shoppingdetail "AltaStore/modules/shoppingdetail"
)

// RepositoryCartDetail is an autogenerated mock type for the RepositoryCartDetail type
type RepositoryCartDetail struct {
        mock.Mock
}

// DeleteItemInShopCart provides a mock function with given fields: cartId, productid
func (_m *RepositoryCartDetail) DeleteItemInShopCart(cartId string, productid string) error <span class="cov8" title="1">{
        ret := _m.Called(cartId, productid)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, productid)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// GetShopCartDetailById provides a mock function with given fields: id
func (_m *RepositoryCartDetail) GetShopCartDetailById(id string) (*[]shoppingdetail.ShopCartDetailItemWithProductName, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *[]shoppingdetail.ShopCartDetailItemWithProductName
        if rf, ok := ret.Get(0).(func(string) *[]shoppingdetail.ShopCartDetailItemWithProductName); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*[]shoppingdetail.ShopCartDetailItemWithProductName)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// ModifyItemInShopCart provides a mock function with given fields: cartId, productid, item
func (_m *RepositoryCartDetail) ModifyItemInShopCart(cartId string, productid string, item *shoppingdetail.UpdateItemInCartSpec) error <span class="cov8" title="1">{
        ret := _m.Called(cartId, productid, item)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string, *shoppingdetail.UpdateItemInCartSpec) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, productid, item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// NewItemInShopCart provides a mock function with given fields: cartId, item
func (_m *RepositoryCartDetail) NewItemInShopCart(cartId string, item *shoppingdetail.InsertItemInCartSpec) error <span class="cov8" title="1">{
        ret := _m.Called(cartId, item)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, *shoppingdetail.InsertItemInCartSpec) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, item)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file73" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        request "AltaStore/api/v1/shopping/request"

        mock "github.com/stretchr/testify/mock"

        shopping "AltaStore/business/shopping"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeleteItemInShopCart provides a mock function with given fields: cartId, productid
func (_m *Service) DeleteItemInShopCart(cartId string, productid string) error <span class="cov0" title="0">{
        ret := _m.Called(cartId, productid)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, productid)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// GetShopCartDetailById provides a mock function with given fields: id
func (_m *Service) GetShopCartDetailById(id string) (*shopping.ShopCartDetail, error) <span class="cov0" title="0">{
        ret := _m.Called(id)

        var r0 *shopping.ShopCartDetail
        if rf, ok := ret.Get(0).(func(string) *shopping.ShopCartDetail); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*shopping.ShopCartDetail)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetShoppingCartByUserId provides a mock function with given fields: userid
func (_m *Service) GetShoppingCartByUserId(userid string) (*shopping.ShoppCart, error) <span class="cov0" title="0">{
        ret := _m.Called(userid)

        var r0 *shopping.ShoppCart
        if rf, ok := ret.Get(0).(func(string) *shopping.ShoppCart); ok </span><span class="cov0" title="0">{
                r0 = rf(userid)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*shopping.ShoppCart)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(userid)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// ModifyItemInShopCart provides a mock function with given fields: cartId, productid, item
func (_m *Service) ModifyItemInShopCart(cartId string, productid string, item *request.DetailItemInShopCart) error <span class="cov0" title="0">{
        ret := _m.Called(cartId, productid, item)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string, *request.DetailItemInShopCart) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, productid, item)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// NewItemInShopCart provides a mock function with given fields: cartId, item
func (_m *Service) NewItemInShopCart(cartId string, item *request.DetailItemInShopCart) error <span class="cov0" title="0">{
        ret := _m.Called(cartId, item)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, *request.DetailItemInShopCart) error); ok </span><span class="cov0" title="0">{
                r0 = rf(cartId, item)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// NewShoppingCart provides a mock function with given fields: userid, description
func (_m *Service) NewShoppingCart(userid string, description string) (*shopping.ShoppCart, error) <span class="cov0" title="0">{
        ret := _m.Called(userid, description)

        var r0 *shopping.ShoppCart
        if rf, ok := ret.Get(0).(func(string, string) *shopping.ShoppCart); ok </span><span class="cov0" title="0">{
                r0 = rf(userid, description)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*shopping.ShoppCart)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(userid, description)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file74" style="display: none">package shopping

import (
        "AltaStore/api/v1/shopping/request"
        "time"

        "github.com/google/uuid"
)

type service struct {
        repository     Repository
        repoCartDetail RepositoryCartDetail
}

func NewService(repository Repository, repoCartDetail RepositoryCartDetail) Service <span class="cov8" title="1">{
        return &amp;service{repository, repoCartDetail}
}</span>

func (s *service) GetShoppingCartByUserId(userid string) (*ShoppCart, error) <span class="cov8" title="1">{
        return s.repository.GetShoppingCartByUserId(userid)
}</span>

func (s *service) NewShoppingCart(userid string, description string) (*ShoppCart, error) <span class="cov8" title="1">{
        return s.repository.NewShoppingCart(uuid.NewString(), userid, description, time.Now())
}</span>

func (s *service) GetShopCartDetailById(id string) (*ShopCartDetail, error) <span class="cov8" title="1">{
        shopCart, err := s.repository.GetShoppingCartById(id)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">items, err := s.repoCartDetail.GetShopCartDetailById(id)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">cnvItems := toDetailItemInCart(items)

        return getShopCartDetailFormat(shopCart, cnvItems), nil</span>
}

func (s *service) NewItemInShopCart(cartId string, item *request.DetailItemInShopCart) error <span class="cov8" title="1">{
        return s.repoCartDetail.NewItemInShopCart(cartId, insertItemFormat(item))

}</span>

func (s *service) ModifyItemInShopCart(cartId string, productid string, item *request.DetailItemInShopCart) error <span class="cov8" title="1">{
        return s.repoCartDetail.ModifyItemInShopCart(cartId, productid, updateItemFormat(productid, item))
}</span>

func (s *service) DeleteItemInShopCart(cartId string, productid string) error <span class="cov8" title="1">{
        return s.repoCartDetail.DeleteItemInShopCart(cartId, productid)
}</span>
</pre>
		
		<pre class="file" id="file75" style="display: none">package shopping

import (
        "AltaStore/api/v1/shopping/request"
        "AltaStore/modules/shoppingdetail"
        "time"

        "github.com/google/uuid"
)

type ShoppCart struct {
        ID          string
        IsCheckOut  bool
        Description string
        CreatedBy   string
        CreatedAt   time.Time
        UpdatedAt   time.Time
}

type ItemInCart struct {
        ID          string
        ProductId   string
        ProductName string
        Price       int
        Qty         int
        UpdatedAt   time.Time
}

type ShopCartDetail struct {
        ID          string
        Description string
        CreatedBy   string
        UpdatedAt   time.Time
        Details     []ItemInCart
}

func getShopCartDetailFormat(sum *ShoppCart, details *[]ItemInCart) *ShopCartDetail <span class="cov8" title="1">{
        var shopCartDetail ShopCartDetail
        var itemInCart *ItemInCart

        shopCartDetail.ID = sum.ID
        shopCartDetail.Description = sum.Description
        shopCartDetail.CreatedBy = sum.CreatedBy
        shopCartDetail.UpdatedAt = sum.UpdatedAt

        for _, val := range *details </span><span class="cov8" title="1">{
                itemInCart = &amp;val
                shopCartDetail.Details = append(shopCartDetail.Details, *itemInCart)
        }</span>

        <span class="cov8" title="1">if shopCartDetail.Details == nil </span><span class="cov0" title="0">{
                shopCartDetail.Details = []ItemInCart{}
        }</span>

        <span class="cov8" title="1">return &amp;shopCartDetail</span>
}

func insertItemFormat(item *request.DetailItemInShopCart) *shoppingdetail.InsertItemInCartSpec <span class="cov8" title="1">{
        return &amp;shoppingdetail.InsertItemInCartSpec{
                ID:        uuid.NewString(),
                ProductId: item.ProductId,
                Price:     item.Price,
                Qty:       item.Qty,
                CreatedAt: time.Now(),
                UpdatedAt: time.Now(),
        }
}</span>

func updateItemFormat(productid string, item *request.DetailItemInShopCart) *shoppingdetail.UpdateItemInCartSpec <span class="cov8" title="1">{
        return &amp;shoppingdetail.UpdateItemInCartSpec{
                ProductId: productid,
                Price:     item.Price,
                Qty:       item.Qty,
                UpdatedAt: time.Now(),
        }
}</span>

func toItem(item shoppingdetail.ShopCartDetailItemWithProductName) ItemInCart <span class="cov8" title="1">{
        return ItemInCart{
                ID:          item.ID,
                ProductId:   item.ProductId,
                ProductName: item.ProductName,
                Price:       item.Price,
                Qty:         item.Qty,
                UpdatedAt:   item.UpdatedAt,
        }
}</span>

func toDetailItemInCart(items *[]shoppingdetail.ShopCartDetailItemWithProductName) *[]ItemInCart <span class="cov8" title="1">{
        var details []ItemInCart

        for _, item := range *items </span><span class="cov8" title="1">{
                details = append(details, toItem(item))
        }</span>

        <span class="cov8" title="1">if details == nil </span><span class="cov0" title="0">{
                details = []ItemInCart{}
        }</span>

        <span class="cov8" title="1">return &amp;details</span>
}
</pre>
		
		<pre class="file" id="file76" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        user "AltaStore/business/user"

        mock "github.com/stretchr/testify/mock"
)

// Repository is an autogenerated mock type for the Repository type
type Repository struct {
        mock.Mock
}

// DeleteUser provides a mock function with given fields: _a0
func (_m *Repository) DeleteUser(_a0 user.User) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(user.User) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// FindUserByEmail provides a mock function with given fields: email
func (_m *Repository) FindUserByEmail(email string) (*user.User, error) <span class="cov8" title="1">{
        ret := _m.Called(email)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(email)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindUserByEmailAndPassword provides a mock function with given fields: email, password
func (_m *Repository) FindUserByEmailAndPassword(email string, password string) (*user.User, error) <span class="cov8" title="1">{
        ret := _m.Called(email, password)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string, string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindUserByID provides a mock function with given fields: id
func (_m *Repository) FindUserByID(id string) (*user.User, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertUser provides a mock function with given fields: _a0
func (_m *Repository) InsertUser(_a0 user.User) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(user.User) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateUser provides a mock function with given fields: _a0
func (_m *Repository) UpdateUser(_a0 user.User) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(user.User) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}

// UpdateUserPassword provides a mock function with given fields: _a0
func (_m *Repository) UpdateUserPassword(_a0 user.User) error <span class="cov8" title="1">{
        ret := _m.Called(_a0)

        var r0 error
        if rf, ok := ret.Get(0).(func(user.User) error); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov8" title="1"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov8" title="1">return r0</span>
}
</pre>
		
		<pre class="file" id="file77" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        user "AltaStore/business/user"

        mock "github.com/stretchr/testify/mock"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// DeleteUser provides a mock function with given fields: id, deleter
func (_m *Service) DeleteUser(id string, deleter string) error <span class="cov0" title="0">{
        ret := _m.Called(id, deleter)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, deleter)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// FindUserByEmail provides a mock function with given fields: email
func (_m *Service) FindUserByEmail(email string) (*user.User, error) <span class="cov0" title="0">{
        ret := _m.Called(email)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(email)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// FindUserByEmailAndPassword provides a mock function with given fields: email, password
func (_m *Service) FindUserByEmailAndPassword(email string, password string) (*user.User, error) <span class="cov8" title="1">{
        ret := _m.Called(email, password)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string, string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// FindUserByID provides a mock function with given fields: id
func (_m *Service) FindUserByID(id string) (*user.User, error) <span class="cov8" title="1">{
        ret := _m.Called(id)

        var r0 *user.User
        if rf, ok := ret.Get(0).(func(string) *user.User); ok </span><span class="cov0" title="0">{
                r0 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*user.User)
                }</span>
        }

        <span class="cov8" title="1">var r1 error
        if rf, ok := ret.Get(1).(func(string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(id)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// InsertUser provides a mock function with given fields: insertUserSpec
func (_m *Service) InsertUser(insertUserSpec user.InsertUserSpec) error <span class="cov0" title="0">{
        ret := _m.Called(insertUserSpec)

        var r0 error
        if rf, ok := ret.Get(0).(func(user.InsertUserSpec) error); ok </span><span class="cov0" title="0">{
                r0 = rf(insertUserSpec)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateUser provides a mock function with given fields: id, updateUserSpec, modifier
func (_m *Service) UpdateUser(id string, updateUserSpec user.UpdateUserSpec, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, updateUserSpec, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, user.UpdateUserSpec, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, updateUserSpec, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}

// UpdateUserPassword provides a mock function with given fields: id, password, oldPassword, modifier
func (_m *Service) UpdateUserPassword(id string, password string, oldPassword string, modifier string) error <span class="cov0" title="0">{
        ret := _m.Called(id, password, oldPassword, modifier)

        var r0 error
        if rf, ok := ret.Get(0).(func(string, string, string, string) error); ok </span><span class="cov0" title="0">{
                r0 = rf(id, password, oldPassword, modifier)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Error(0)
        }</span>

        <span class="cov0" title="0">return r0</span>
}
</pre>
		
		<pre class="file" id="file78" style="display: none">package user

import (
        "AltaStore/business"
        "AltaStore/util/validator"
        "time"

        "github.com/google/uuid"
        "golang.org/x/crypto/bcrypt"
)

//InsertUserSpec create user spec
type InsertUserSpec struct {
        Email     string `validate:"required"`
        FirstName string `validate:"required"`
        LastName  string `validate:"required"`
        Password  string `validate:"required"`
}

type UpdateUserSpec struct {
        Email     string `validate:"required"`
        FirstName string `validate:"required"`
        LastName  string `validate:"required"`
        HandPhone string
        Address   string
}

type UpdateUserPasswordSpec struct {
        NewPassword string `validate:"required"`
        OldPassword string `validate:"required"`
}

//=============== The implementation of those interface put below =======================
type service struct {
        repository Repository
}

//NewService Construct user service object
func NewService(repository Repository) Service <span class="cov8" title="1">{
        return &amp;service{
                repository,
        }
}</span>

//InsertUser Create new user and store into database
func (s *service) InsertUser(insertUserSpec InsertUserSpec) error <span class="cov8" title="1">{
        err := validator.GetValidator().Struct(insertUserSpec)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>

        <span class="cov8" title="1">userdata, _ := s.repository.FindUserByEmail(insertUserSpec.Email)
        if userdata != nil </span><span class="cov8" title="1">{
                return business.ErrDataExists
        }</span>

        <span class="cov8" title="1">hashedPassword, err := bcrypt.GenerateFromPassword([]byte(insertUserSpec.Password), bcrypt.DefaultCost)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>
        <span class="cov8" title="1">var newuuid = uuid.New().String()
        user := NewUser(
                newuuid,
                insertUserSpec.Email,
                insertUserSpec.FirstName,
                insertUserSpec.LastName,
                string(hashedPassword),
                newuuid,
                time.Now(),
        )

        err = s.repository.InsertUser(user)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}

//FindUserByUsernameAndPassword If data not found will return nil
func (s *service) FindUserByEmailAndPassword(email string, password string) (*User, error) <span class="cov8" title="1">{
        return s.repository.FindUserByEmailAndPassword(email, password)
}</span>

//FindUserByUsername If data not found will return nil
func (s *service) FindUserByEmail(email string) (*User, error) <span class="cov8" title="1">{
        return s.repository.FindUserByEmail(email)
}</span>

//FindUserByID If data not found will return nil without error
func (s *service) FindUserByID(id string) (*User, error) <span class="cov8" title="1">{
        return s.repository.FindUserByID(id)
}</span>

//UpdateUserPaasword if data not found or old password wrong will return error
func (s *service) UpdateUserPassword(id string, newpassword, oldPassword string, modifier string) error <span class="cov8" title="1">{

        user, err := s.repository.FindUserByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if user == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if user.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> {
                _, err := s.repository.FindUserByEmailAndPassword(user.Email, oldPassword)
                if err != nil </span><span class="cov8" title="1">{
                        return business.ErrPasswordMisMatch
                }</span>
        }
        <span class="cov8" title="1">hashedPassword, err := bcrypt.GenerateFromPassword([]byte(newpassword), bcrypt.DefaultCost)
        if err != nil </span><span class="cov0" title="0">{
                return business.ErrInvalidSpec
        }</span>
        <span class="cov8" title="1">modifiedUser := user.ModifyUserPassword(
                string(hashedPassword),
                modifier,
                time.Now(),
        )

        return s.repository.UpdateUserPassword(modifiedUser)</span>
}

//UpdateUser if data not found will return error
func (s *service) UpdateUser(id string, updateUserSpec UpdateUserSpec, modifier string) error <span class="cov8" title="1">{
        user, err := s.repository.FindUserByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if user == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span> else<span class="cov8" title="1"> if user.DeletedBy != "" </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>

        <span class="cov8" title="1">modifiedUser := user.ModifyUser(
                updateUserSpec.FirstName,
                updateUserSpec.LastName,
                updateUserSpec.HandPhone,
                updateUserSpec.Address,
                time.Now(),
                modifier,
        )

        return s.repository.UpdateUser(modifiedUser)</span>
}

//Deleteuser if data not found will return error
func (s *service) DeleteUser(id string, modifier string) error <span class="cov8" title="1">{
        user, err := s.repository.FindUserByID(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span> else<span class="cov8" title="1"> if user == nil </span><span class="cov0" title="0">{
                return business.ErrNotFound
        }</span>

        <span class="cov8" title="1">deleteUser := user.DeleteUser(
                time.Now(),
                modifier,
        )

        return s.repository.DeleteUser(deleteUser)</span>
}
</pre>
		
		<pre class="file" id="file79" style="display: none">package user

import (
        "time"
)

//User
type User struct {
        ID        string
        Email     string
        FirstName string
        LastName  string
        Password  string
        HandPhone string
        Address   string
        CreatedAt time.Time
        CreatedBy string
        UpdatedAt time.Time
        UpdatedBy string
        DeletedAt time.Time
        DeletedBy string
}

//NewUser create new User
func NewUser(
        id string,
        email string,
        firstname string,
        lastname string,
        password string,
        creator string,
        createdAt time.Time) User <span class="cov8" title="1">{

        return User{
                ID:        id,
                Email:     email,
                FirstName: firstname,
                LastName:  lastname,
                Password:  password,
                CreatedAt: createdAt,
                CreatedBy: creator,
        }
}</span>

//ModifyUser update existing UserData
func (oldData *User) ModifyUser(
        newFirstName,
        newLastName,
        newHandPhone,
        newAddress string,
        updatedAt time.Time,
        updater string) User <span class="cov8" title="1">{

        return User{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: newFirstName,
                LastName:  newLastName,
                Password:  oldData.Password,
                HandPhone: newHandPhone,
                Address:   newAddress,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: updatedAt,
                UpdatedBy: updater,
        }
}</span>

// //ModifyUserToken update existing UserData
// func (oldData *User) ModifyUserToken(
//         newToken string,
//         updatedAt time.Time) User {

//         return User{
//                 ID:        oldData.ID,
//                 Email:     oldData.Email,
//                 FirstName: oldData.FirstName,
//                 LastName:  oldData.LastName,
//                 Password:  oldData.Password,
//                 HandPhone: oldData.HandPhone,
//                 Address:   oldData.Address,
//                 Token:     newToken,
//                 CreatedAt: oldData.CreatedAt,
//                 CreatedBy: oldData.CreatedBy,
//                 UpdatedAt: updatedAt,
//                 UpdatedBy: oldData.ID,
//         }
// }

//ModifyUserPassword update existing UserData
func (oldData *User) ModifyUserPassword(
        newPassword string,
        updater string,
        updatedAt time.Time) User <span class="cov8" title="1">{

        return User{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: oldData.FirstName,
                LastName:  oldData.LastName,
                Password:  newPassword,
                HandPhone: oldData.HandPhone,
                Address:   oldData.Address,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: updatedAt,
                UpdatedBy: updater,
        }
}</span>

func (oldData *User) DeleteUser(
        deleteAt time.Time,
        deleter string) User <span class="cov8" title="1">{

        return User{
                ID:        oldData.ID,
                Email:     oldData.Email,
                FirstName: oldData.FirstName,
                LastName:  oldData.LastName,
                Password:  oldData.Password,
                HandPhone: oldData.HandPhone,
                Address:   oldData.Address,
                CreatedAt: oldData.CreatedAt,
                CreatedBy: oldData.CreatedBy,
                UpdatedAt: oldData.UpdatedAt,
                UpdatedBy: oldData.UpdatedBy,
                DeletedAt: deleteAt,
                DeletedBy: deleter,
        }
}</span>
</pre>
		
		<pre class="file" id="file80" style="display: none">// Code generated by mockery v2.9.4. DO NOT EDIT.

package mocks

import (
        user "AltaStore/business/user"

        mock "github.com/stretchr/testify/mock"

        userauth "AltaStore/business/userauth"
)

// Service is an autogenerated mock type for the Service type
type Service struct {
        mock.Mock
}

// CreateToken provides a mock function with given fields: _a0
func (_m *Service) CreateToken(_a0 *user.User) (*userauth.TokenDetails, error) <span class="cov0" title="0">{
        ret := _m.Called(_a0)

        var r0 *userauth.TokenDetails
        if rf, ok := ret.Get(0).(func(*user.User) *userauth.TokenDetails); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*userauth.TokenDetails)
                }</span>
        }

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(*user.User) error); ok </span><span class="cov0" title="0">{
                r1 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// UserLogin provides a mock function with given fields: email, password
func (_m *Service) UserLogin(email string, password string) (string, error) <span class="cov0" title="0">{
        ret := _m.Called(email, password)

        var r0 string
        if rf, ok := ret.Get(0).(func(string, string) string); ok </span><span class="cov0" title="0">{
                r0 = rf(email, password)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Get(0).(string)
        }</span>

        <span class="cov0" title="0">var r1 error
        if rf, ok := ret.Get(1).(func(string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(email, password)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}
</pre>
		
		<pre class="file" id="file81" style="display: none">package userauth

import (
        "AltaStore/business"
        "AltaStore/business/user"
        "AltaStore/config"
        "time"

        "github.com/golang-jwt/jwt"
        uuid "github.com/google/uuid"
)

//=============== The implementation of those interface put below =======================
type service struct {
        userService user.Service
        //authService Repository
}

// //NewService Construct user service object
// func NewService(userService user.Service, authService Repository) Service {
//         return &amp;service{
//                 userService, authService,
//         }
// }

//NewService Construct user service object
func NewService(userService user.Service) Service <span class="cov8" title="1">{
        return &amp;service{
                userService,
        }
}</span>

//Login by given user Email and Password, return error if not exist
func (s *service) UserLogin(username string, password string) (string, error) <span class="cov8" title="1">{
        user, err := s.userService.FindUserByEmailAndPassword(username, password)
        if err != nil </span><span class="cov8" title="1">{
                return "", business.ErrUnAuthorized
        }</span>
        <span class="cov8" title="1">td, err := s.CreateToken(user)
        if err != nil </span><span class="cov0" title="0">{
                return "", business.ErrUnAuthorized
        }</span>
        // err = s.authService.InsertToken(user, td)
        // if err != nil {
        //         return "", business.ErrUnAuthorized
        // }
        <span class="cov8" title="1">return td.AccessToken, nil</span>
}

func (s *service) CreateToken(user *user.User) (*TokenDetails, error) <span class="cov8" title="1">{
        td := &amp;TokenDetails{}
        td.AtExpires = time.Now().Add(time.Hour * 24).Unix()
        td.AccessUuid = uuid.New().String()

        var err error
        //Creating Access Token
        atClaims := jwt.MapClaims{}
        atClaims["authorized"] = true
        atClaims["access_uuid"] = td.AccessUuid
        atClaims["userId"] = user.ID
        atClaims["exp"] = td.AtExpires
        at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims)
        td.AccessToken, err = at.SignedString([]byte(config.GetConfig().JwtSecretKey))
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return td, nil</span>
}
</pre>
		
		<pre class="file" id="file82" style="display: none">package config

import (
        "github.com/labstack/gommon/log"
        "github.com/spf13/viper"
)

type ConfigApp struct {
        AppHost           string `mapstructure:"app_host"`
        AppPort           int    `mapstructure:"app_port"`
        DbDriver          string `mapstructure:"db_driver"`
        DbHost            string `mapstructure:"db_host"`
        DbPort            int    `mapstructure:"db_port"`
        DbUsername        string `mapstructure:"db_username"`
        DbPassword        string `mapstructure:"db_password"`
        DbName            string `mapstructure:"db_name"`
        JwtSecretKey      string `mapstructure:"jwtsecretkey"`
        RedisHost         string `mapstructure:"redis_host"`
        RedisPort         int    `mapstructure:"redis_port"`
        MidTransServerKey string `mapstructure:"midtransserverkey"`
        MongoHost         string `mapstructure:"mongo_host"`
        MongoPort         int    `mapstructure:"mongo_port"`
        MongoUsername     string `mapstructure:"mongo_username"`
        MongoPassword     string `mapstructure:"mongo_password"`
        MongoDbName       string `mapstructure:"mongo_dbname"`
}

func GetConfig() *ConfigApp <span class="cov8" title="1">{
        // Set default config if error parsing file
        var defaConfig ConfigApp

        defaConfig.AppHost = "localhost"
        defaConfig.AppPort = 9000
        defaConfig.DbDriver = "pgsql"
        defaConfig.DbHost = "localhost"
        defaConfig.DbPort = 5432
        defaConfig.DbUsername = "postgres"
        defaConfig.DbPassword = "postgres"
        defaConfig.DbName = "altastoredb"
        defaConfig.JwtSecretKey = "AltaStore"
        defaConfig.RedisHost = "localhost"
        defaConfig.RedisPort = 9001
        defaConfig.MongoHost = "localhost"
        defaConfig.MongoPort = 27017
        defaConfig.MongoUsername = "mongo"
        defaConfig.MongoPassword = "mongo"
        defaConfig.MongoDbName = "altastoredb"

        var (
                err error
        )

        viper.SetConfigFile("./.env")
        err = viper.ReadInConfig()
        if err != nil </span><span class="cov8" title="1">{
                log.Info("Failed read config, config set to default2.")
                return &amp;defaConfig
        }</span>

        <span class="cov0" title="0">var finalConfig ConfigApp
        err = viper.Unmarshal(&amp;finalConfig)
        if err != nil </span><span class="cov0" title="0">{
                log.Info("Failed bind config, config set to default3.")
                return &amp;defaConfig
        }</span>

        <span class="cov0" title="0">return &amp;finalConfig</span>
}
</pre>
		
		<pre class="file" id="file83" style="display: none">package main

import (
        "AltaStore/api"
        "AltaStore/api/middleware"

        // Controller
        adminController "AltaStore/api/v1/admin"
        adminAuthController "AltaStore/api/v1/adminauth"
        cateController "AltaStore/api/v1/category"
        checkoutController "AltaStore/api/v1/checkout"
        productController "AltaStore/api/v1/product"
        userController "AltaStore/api/v1/user"
        userAuthController "AltaStore/api/v1/userauth"

        // Service
        adminService "AltaStore/business/admin"
        adminAuthService "AltaStore/business/adminauth"
        cateService "AltaStore/business/category"
        checkoutService "AltaStore/business/checkout"
        productService "AltaStore/business/product"
        userService "AltaStore/business/user"
        userAuthService "AltaStore/business/userauth"

        "AltaStore/config"

        // Repository
        adminRepository "AltaStore/modules/admin"
        cateRepository "AltaStore/modules/category"
        checkoutRepository "AltaStore/modules/checkout"
        "AltaStore/modules/migration"
        productRepository "AltaStore/modules/product"
        userRepository "AltaStore/modules/user"

        "context"
        "time"

        shopController "AltaStore/api/v1/shopping"
        shopService "AltaStore/business/shopping"
        shopRepository "AltaStore/modules/shopping"
        shopDetailRepository "AltaStore/modules/shoppingdetail"

        purchaseController "AltaStore/api/v1/purchasereceiving"
        purchaseService "AltaStore/business/purchasereceiving"
        purchaseRepository "AltaStore/modules/purchasereceiving"
        purchaseDetailRepository "AltaStore/modules/purchasereceivingdetail"

        paymentController "AltaStore/api/v1/checkoutpayment"
        paymentService "AltaStore/business/checkoutpayment"
        paymentRepository "AltaStore/modules/checkoutpayment"
        "fmt"

        "go.mongodb.org/mongo-driver/mongo"
        "go.mongodb.org/mongo-driver/mongo/options"

        "github.com/go-redis/redis/v7"
        "github.com/labstack/echo/v4"
        "gorm.io/driver/postgres"
        "gorm.io/gorm"
)

func newDatabaseConnection(cfg *config.ConfigApp) *gorm.DB <span class="cov0" title="0">{
        stringConnection := fmt.Sprintf(
                "host=%s port=%d user=%s password=%s dbname=%s",
                cfg.DbHost, cfg.DbPort, cfg.DbUsername, cfg.DbPassword, cfg.DbName,
        )
        db, err := gorm.Open(postgres.Open(stringConnection), &amp;gorm.Config{})

        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">migration.TableMigration(db)

        return db</span>
}

func newMongoDBConnection(cfg *config.ConfigApp) *mongo.Database <span class="cov0" title="0">{
        clientOptions := options.Client().ApplyURI(
                fmt.Sprintf("mongodb://%s:%s@%s:%d", cfg.MongoUsername, cfg.MongoPassword, cfg.MongoHost, cfg.MongoPort),
        )

        client, err := mongo.NewClient(clientOptions)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">err = client.Connect(context.Background())
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">return client.Database(cfg.MongoDbName)</span>
}

func newRedisConnection(cfg *config.ConfigApp) *redis.Client <span class="cov0" title="0">{
        // stringConnection := fmt.Sprintf(
        //         "%s:%d",
        //         cfg.RedisHost, cfg.RedisPort,
        // )
        // client := redis.NewClient(&amp;redis.Options{
        //         Addr:     stringConnection, // redis port
        //         Password: "",               // no password set
        //         DB:       0,                // use default DB
        // })
        // _, err := client.Ping().Result()
        // if err != nil {
        //         panic(err)
        // }
        // return client
        return nil
}</span>

func main() <span class="cov0" title="0">{
        // retrieves application configuration and returns common values when there is a problem
        config := config.GetConfig()

        // // Open mongodb logger
        // mongoConnection := newMongoDBConnection(config)

        // // Register repository
        // logrRepo := loggerRepo.NewRepository(mongoConnection)

        // // Register service
        // logeService := loggerService.NewService(logrRepo)

        // // Register logs
        // log.SetFormatter(&amp;log.JSONFormatter{})
        // log.SetOutput(logeService)

        // open database server base session
        dbConnection := newDatabaseConnection(config)

        // open redis connection
        //redisConnection := newRedisConnection(config)
        _ = newRedisConnection(config)

        //initiate user repository
        user := userRepository.NewDBRepository(dbConnection)

        //initiate user service
        userService := userService.NewService(user)

        //initiate user controller
        userController := userController.NewController(userService)

        // Initiate Respository Category
        //_ = authRepository.NewRepository(redisConnection)

        //initiate admin repository
        admin := adminRepository.NewDBRepository(dbConnection)

        //initiate admin service
        adminService := adminService.NewService(admin)

        //initiate admin controller
        adminController := adminController.NewController(adminService)

        //initiate auth service
        userAuthService := userAuthService.NewService(userService)

        //initiate auth controller
        userAuthController := userAuthController.NewController(userAuthService)

        //initiate auth service
        adminAuthService := adminAuthService.NewService(adminService)

        //initiate auth controller
        adminAuthController := adminAuthController.NewController(adminAuthService)

        // Initiate Respository Category
        categoryRepo := cateRepository.NewRepository(dbConnection)

        // Initiate Service Category
        categoryService := cateService.NewService(adminService, categoryRepo)

        // Initiate Controller Category
        controllerCategory := cateController.NewController(categoryService)

        // Initiate Respository Product
        product := productRepository.NewRepository(dbConnection)

        // Initiate Service Product
        ProductService := productService.NewService(adminService, product)

        // Initiate Controller Product
        productController := productController.NewController(ProductService)

        // initiate shopping repository
        shopRepo := shopRepository.NewRepository(dbConnection)
        shopDetailRepo := shopDetailRepository.NewRepository(dbConnection)

        // initiate urchase Receiving service
        shopServc := shopService.NewService(shopRepo, shopDetailRepo)

        // initiate shopping controller
        shopHandler := shopController.NewController(shopServc)

        // initiate Purchase Receiving repository
        purchase := purchaseRepository.NewRepository(dbConnection)
        purchaseDetail := purchaseDetailRepository.NewRepository(dbConnection)

        // initiate Purchase Receiving service
        purchaseService := purchaseService.NewService(adminService, purchase, purchaseDetail)

        // initiate Purchase Receiving controller
        purchaseController := purchaseController.NewController(purchaseService)

        // initiate CheckOut Payment repository
        payment := paymentRepository.NewRepository(dbConnection)

        // initiate CheckOut Payment service
        paymentService := paymentService.NewService(userService, payment)

        // initiate CheckOut Payment controller
        paymentController := paymentController.NewController(paymentService)

        // initiate checkout repository shoping cart
        c_outeRepo := checkoutRepository.NewRepository(dbConnection)

        // initiate checkout service shopping cat
        c_outServc := checkoutService.NewService(paymentService, c_outeRepo, shopDetailRepo)

        // initiate checkout controller shopingcart
        c_outController := checkoutController.NewController(c_outServc)

        // create echo http
        e := echo.New()

        // Register API Path and Controller
        api.RegisterPath(e,
                controllerCategory,
                userController,
                adminController,
                userAuthController,
                adminAuthController,
                productController,
                shopHandler,
                c_outController,
                purchaseController,
                paymentController,
        )

        lock := make(chan error)

        go func(lock chan error) </span><span class="cov0" title="0">{
                address := fmt.Sprintf(":%d", config.AppPort)
                lock &lt;- e.Start(address)
        }</span>(lock)

        <span class="cov0" title="0">time.Sleep(1 * time.Millisecond)
        middleware.MakeLogEntry(nil).Info(fmt.Sprintf("Application Start In Port =&gt; ::%d", config.AppPort))

        err := &lt;-lock
        if err != nil </span><span class="cov0" title="0">{
                middleware.MakeLogEntry(nil).Panic("Shutdown Echo Service")
        }</span>
}
</pre>
		
		<pre class="file" id="file84" style="display: none">package admin

import (
        "AltaStore/business/admin"

        "time"

        "golang.org/x/crypto/bcrypt"
        "gorm.io/gorm"
)

// Implementasi repositori admin
type Repository struct {
        DB *gorm.DB
}

type Admin struct {
        ID        string    `gorm:"type:uuid;primary_key"`
        Email     string    `gorm:"email;index:idx_admin_email,unique;type:varchar(50)"`
        FirstName string    `gorm:"firstname;type:varchar(50)"`
        LastName  string    `gorm:"lastname;type:varchar(50)"`
        Password  string    `gorm:"password;type:varchar(100)"`
        CreatedAt time.Time `gorm:"created_at"`
        CreatedBy string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt time.Time `gorm:"updated_at"`
        UpdatedBy string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt time.Time `gorm:"deleted_at"`
        DeletedBy string    `gorm:"deleted_by;type:varchar(50)"`
}

func newAdminTable(admin admin.Admin) *Admin <span class="cov0" title="0">{

        return &amp;Admin{
                admin.ID,
                admin.Email,
                admin.FirstName,
                admin.LastName,
                admin.Password,
                admin.CreatedAt,
                admin.CreatedBy,
                admin.UpdatedAt,
                admin.UpdatedBy,
                admin.DeletedAt,
                admin.DeletedBy,
        }
}</span>

func (col *Admin) Toadmin() admin.Admin <span class="cov0" title="0">{
        var admin admin.Admin

        admin.ID = col.ID
        admin.Email = col.Email
        admin.FirstName = col.FirstName
        admin.LastName = col.LastName
        admin.CreatedAt = col.CreatedAt
        admin.CreatedBy = col.CreatedBy
        admin.UpdatedAt = col.UpdatedAt
        admin.UpdatedBy = col.UpdatedBy
        admin.DeletedAt = col.DeletedAt
        admin.DeletedBy = col.DeletedBy

        return admin
}</span>

// Menghasilkan ORM DB untuk admin repository
func NewDBRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

//InsertAdmin Insert new Admin into storage
func (repo *Repository) InsertAdmin(admin admin.Admin) error <span class="cov0" title="0">{

        adminData := newAdminTable(admin)

        err := repo.DB.Create(adminData).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//FindAdminByEmailAndPassword If data not found will return nil
func (repo *Repository) FindAdminByEmailAndPassword(email string, password string) (*admin.Admin, error) <span class="cov0" title="0">{

        var adminData Admin

        err := repo.DB.Where("email = ?", email).Where("deleted_by = ''").First(&amp;adminData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        // Comparing the password with the hash
        <span class="cov0" title="0">err = bcrypt.CompareHashAndPassword([]byte(adminData.Password), []byte(password))
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">Admin := adminData.Toadmin()

        return &amp;Admin, nil</span>
}

func (repo *Repository) FindAdminByEmail(email string) (*admin.Admin, error) <span class="cov0" title="0">{

        var adminData Admin

        err := repo.DB.Where("email = ?", email).Where("deleted_by = ''").First(&amp;adminData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">Admin := adminData.Toadmin()

        return &amp;Admin, nil</span>
}

//FindAdminByID If data not found will return nil without error
func (repo *Repository) FindAdminByID(id string) (*admin.Admin, error) <span class="cov0" title="0">{

        var adminData Admin

        err := repo.DB.Where("id = ?", id).Where("deleted_by = ''").First(&amp;adminData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">Admin := adminData.Toadmin()

        return &amp;Admin, nil</span>
}

//UpdateAdminPassword if data not found or old password wrong will return error
func (repo *Repository) UpdateAdminPassword(admin admin.Admin) error <span class="cov0" title="0">{
        adminData := newAdminTable(admin)

        err := repo.DB.Model(&amp;adminData).Updates(Admin{
                Password: adminData.Password,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//UpdateAdmin Update existing Admin in database
func (repo *Repository) UpdateAdmin(admin admin.Admin) error <span class="cov0" title="0">{
        AdminData := newAdminTable(admin)

        err := repo.DB.Model(&amp;AdminData).Updates(Admin{
                FirstName: AdminData.FirstName,
                LastName:  AdminData.LastName,
                Password:  AdminData.Password,
                UpdatedAt: AdminData.UpdatedAt,
                UpdatedBy: AdminData.UpdatedBy,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//DeleteAdmin Set IsDelete true in database
func (repo *Repository) DeleteAdmin(admin admin.Admin) error <span class="cov0" title="0">{
        adminData := newAdminTable(admin)

        err := repo.DB.Model(&amp;adminData).Updates(Admin{
                DeletedBy: adminData.DeletedBy,
                DeletedAt: adminData.DeletedAt,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}
</pre>
		
		<pre class="file" id="file85" style="display: none">package category

import (
        "AltaStore/business/category"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type ProductCategory struct {
        ID        string    `gorm:"id;type:uuid;primaryKey"`
        Code      string    `gorm:"code;type:varchar(50);unique"`
        Name      string    `gorm:"name;type:varchar(100)"`
        CreatedAt time.Time `gorm:"created_at"`
        CreatedBy string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt time.Time `gorm:"updated_at"`
        UpdatedBy string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt time.Time `gorm:"deleted_at"`
        DeletedBy string    `gorm:"deleted_by;type:varchar(50)"`
}

func (p *ProductCategory) toCategory() category.Category <span class="cov0" title="0">{
        return category.Category{
                ID:        p.ID,
                Code:      p.Code,
                Name:      p.Name,
                CreatedAt: p.CreatedAt,
                CreatedBy: p.CreatedBy,
                UpdatedAt: p.UpdatedAt,
                UpdatedBy: p.UpdatedBy,
        }
}</span>

func newDataCategory(cat category.Category) *ProductCategory <span class="cov0" title="0">{
        return &amp;ProductCategory{
                ID:        cat.ID,
                Code:      cat.Code,
                Name:      cat.Name,
                CreatedAt: cat.CreatedAt,
                CreatedBy: cat.CreatedBy,
                UpdatedAt: cat.CreatedAt,
                UpdatedBy: cat.CreatedBy,
        }
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) GetAllCategory() (*[]category.Category, error) <span class="cov0" title="0">{
        var categories []ProductCategory

        err := r.DB.Find(&amp;categories).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">var result []category.Category
        for _, value := range categories </span><span class="cov0" title="0">{
                result = append(result, value.toCategory())
        }</span>

        <span class="cov0" title="0">return &amp;result, nil</span>
}

func (r *Repository) FindCategoryById(id string) (*category.Category, error) <span class="cov0" title="0">{
        var category ProductCategory

        err := r.DB.First(&amp;category, "id = ?", id).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">response := category.toCategory()
        return &amp;response, nil</span>
}

func (r *Repository) FindCategoryByCode(code string) (*category.Category, error) <span class="cov0" title="0">{
        var category ProductCategory

        err := r.DB.First(&amp;category, "code = ?", code).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">response := category.toCategory()
        return &amp;response, nil</span>
}

func (r *Repository) InsertCategory(cat category.Category) error <span class="cov0" title="0">{
        dataCategory := newDataCategory(cat)
        if err := r.DB.Create(dataCategory).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) UpdateCategory(id string, cat category.Category) error <span class="cov0" title="0">{
        var category ProductCategory
        var err error

        err = r.DB.First(&amp;category, "id = ?", id).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">err = r.DB.Model(&amp;category).Updates(
                ProductCategory{Name: cat.Name, UpdatedAt: cat.UpdatedAt, UpdatedBy: cat.UpdatedBy},
        ).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) DeleteCategory(id string, userid string) error <span class="cov0" title="0">{
        var category ProductCategory
        var err error

        if err = r.DB.First(&amp;category, "id = ?", id).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">if err = r.DB.Model(&amp;category).Update("deleted_by", userid).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">r.DB.Delete(&amp;category)
        return nil</span>
}
</pre>
		
		<pre class="file" id="file86" style="display: none">package checkout

import (
        "AltaStore/business/checkout"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type Checkout struct {
        ID             string    `gorm:"id;type:uuid;primaryKey"`
        ShoppingCartId string    `gorm:"shopping_cart_id;type:uuid;unique"`
        Description    string    `gorm:"description;type:varchar(100)"`
        CreatedBy      string    `gorm:"created_by;type:varchar(50)"`
        CreatedAt      time.Time `gorm:"created_at;type:timestamp"`
        UpdatedAt      time.Time `gorm:"updated_at;type:timestamp"`
        DeletedAt      time.Time `gorm:"deleted_at;type:timestamp"`
}

func (c *Checkout) toBusinessCheckout() checkout.Checkout <span class="cov0" title="0">{
        return checkout.Checkout{
                ID:             c.ID,
                ShoppingCardId: c.ShoppingCartId,
                Description:    c.Description,
                CreatedBy:      c.CreatedBy,
                CreatedAt:      c.CreatedAt,
                UpdatedAt:      c.UpdatedAt,
        }
}</span>
func toListCheckout(c *[]Checkout) *[]checkout.Checkout <span class="cov0" title="0">{
        var listCheckout []checkout.Checkout

        for _, checkout := range *c </span><span class="cov0" title="0">{
                listCheckout = append(listCheckout, checkout.toBusinessCheckout())
        }</span>

        <span class="cov0" title="0">if listCheckout == nil </span><span class="cov0" title="0">{
                listCheckout = []checkout.Checkout{}
        }</span>

        <span class="cov0" title="0">return &amp;listCheckout</span>
}

func insertCheckout(data *checkout.Checkout) *Checkout <span class="cov0" title="0">{
        return &amp;Checkout{
                ID:             data.ID,
                ShoppingCartId: data.ShoppingCardId,
                Description:    data.Description,
                CreatedBy:      data.CreatedBy,
                CreatedAt:      data.CreatedAt,
                UpdatedAt:      data.UpdatedAt,
        }
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) NewCheckoutShoppingCart(checkout *checkout.Checkout) error <span class="cov0" title="0">{
        checkoutShopCart := insertCheckout(checkout)

        return r.DB.Create(&amp;checkoutShopCart).Error
}</span>

func (r *Repository) GetAllCheckout() (*[]checkout.Checkout, error) <span class="cov0" title="0">{
        var checkoutList []Checkout

        err := r.DB.Find(&amp;checkoutList).Order("created_at asc").Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return toListCheckout(&amp;checkoutList), nil</span>
}

func (r *Repository) GetCheckoutById(id string) (*checkout.Checkout, error) <span class="cov0" title="0">{
        checkout := new(Checkout)

        err := r.DB.First(checkout, " id = ? ", id).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">result := checkout.toBusinessCheckout()

        return &amp;result, nil</span>
}
</pre>
		
		<pre class="file" id="file87" style="display: none">package checkoutpayment

import (
        "AltaStore/business/checkoutpayment"
        "time"

        "gorm.io/gorm"
)

type CheckoutPayment struct {
        CheckOutID        string                        `gorm:"checkout_id;type:uuid"`
        MerchantId        string                        `gorm:"merchant_id"`
        StatusCode        string                        `gorm:"status_code"`
        TransactionStatus checkoutpayment.PaymentStatus `gorm:"transaction_status"`
        FraudStatus       checkoutpayment.FraudStatus   `gorm:"fraud_status"`
        CreatedAt         time.Time                     `gorm:"created_at"`
        CreatedBy         string                        `gorm:"created_by;type:varchar(50)"`
        UpdatedAt         time.Time                     `gorm:"updated_at"`
        UpdatedBy         string                        `gorm:"updated_by;type:varchar(50)"`
        DeletedAt         time.Time                     `gorm:"deleted_at"`
        DeletedBy         string                        `gorm:"deleted_by;type:varchar(50)"`
}

func (p *CheckoutPayment) ToPayment() *checkoutpayment.CheckoutPayment <span class="cov0" title="0">{
        return &amp;checkoutpayment.CheckoutPayment{
                CheckOutID:        p.CheckOutID,
                MerchantId:        p.MerchantId,
                StatusCode:        p.StatusCode,
                TransactionStatus: p.TransactionStatus,
                FraudStatus:       p.FraudStatus,
                CreatedAt:         p.CreatedAt,
                CreatedBy:         p.CreatedBy,
                UpdatedAt:         p.UpdatedAt,
                UpdatedBy:         p.UpdatedBy,
                DeletedAt:         p.DeletedAt,
                DeletedBy:         p.DeletedBy,
        }
}</span>

func newPayment(p *checkoutpayment.CheckoutPayment) *CheckoutPayment <span class="cov0" title="0">{
        return &amp;CheckoutPayment{
                CheckOutID:        p.CheckOutID,
                MerchantId:        p.MerchantId,
                StatusCode:        p.StatusCode,
                TransactionStatus: p.TransactionStatus,
                FraudStatus:       p.FraudStatus,
                CreatedAt:         p.CreatedAt,
                CreatedBy:         p.CreatedBy,
                UpdatedAt:         p.UpdatedAt,
                UpdatedBy:         p.UpdatedBy,
                DeletedAt:         p.DeletedAt,
                DeletedBy:         p.DeletedBy,
        }
}</span>

type Repository struct {
        DB *gorm.DB
}

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>
func (r *Repository) InsertPayment(p *checkoutpayment.CheckoutPayment) (*checkoutpayment.CheckoutPayment, error) <span class="cov0" title="0">{
        data := newPayment(p)
        if err := r.DB.Create(data).Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return data.ToPayment(), nil</span>
}

// func (r *Repository) UpdatePayment(p *checkoutpayment.CheckoutPayment) error {
//         data := newPayment(p)
//         err := r.DB.Model(&amp;data).Updates(checkoutpayment.CheckoutPayment{
//                 MerchantId:        data.MerchantId,
//                 TransactionStatus: data.TransactionStatus,
//                 FraudStatus:       data.FraudStatus,
//                 UpdatedAt:         data.UpdatedAt,
//                 UpdatedBy:         data.UpdatedBy,
//         }).Error
//         if err != nil {
//                 return err
//         }
//         return nil
// }
</pre>
		
		<pre class="file" id="file88" style="display: none">package logger

import (
        "context"

        "AltaStore/business/logger"

        "go.mongodb.org/mongo-driver/mongo"
)

type Repository struct {
        DB *mongo.Database
}

func NewRepository(db *mongo.Database) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) AddLoggerActivity(data *logger.LoggerData) error <span class="cov0" title="0">{

        _, err := r.DB.Collection("logs").InsertOne(context.Background(), data)

        return err
}</span>
</pre>
		
		<pre class="file" id="file89" style="display: none">package migration

import (
        "AltaStore/business/checkoutpayment"
        "AltaStore/modules/admin"
        "AltaStore/modules/category"
        "AltaStore/modules/checkout"
        "AltaStore/modules/product"
        "AltaStore/modules/purchasereceiving"

        "AltaStore/modules/purchasereceivingdetail"
        "AltaStore/modules/shopping"
        "AltaStore/modules/shoppingdetail"
        "AltaStore/modules/user"

        "gorm.io/gorm"
)

func TableMigration(db *gorm.DB) <span class="cov0" title="0">{
        db.AutoMigrate(&amp;category.ProductCategory{},
                &amp;shopping.ShoppingCart{},
                &amp;user.User{},
                &amp;product.Product{},
                &amp;admin.Admin{},
                &amp;shoppingdetail.ShoppingCartDetail{},
                &amp;checkout.Checkout{},
                &amp;purchasereceiving.PurchaseReceiving{},
                &amp;purchasereceivingdetail.PurchaseReceivingDetail{},
                &amp;checkoutpayment.CheckoutPayment{},
        )
}</span>
</pre>
		
		<pre class="file" id="file90" style="display: none">package product

import (
        "AltaStore/business/product"
        category "AltaStore/modules/category"
        "fmt"
        "strconv"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type Product struct {
        ID                string `gorm:"id;type:uuid;primaryKey"`
        Code              string `gorm:"code;type:varchar(50);unique"`
        Name              string `gorm:"name;type:varchar(100)"`
        Price             int64  `gorm:"price"`
        ProductCategoryId string `gorm:"productcategoryid;type:uuid"`
        ProductCategory   category.ProductCategory
        IsActive          bool      `gorm:"isactive;type:boolean"`
        UnitName          string    `gorm:"unitname;type:varchar(50)"`
        Description       string    `gorm:"description;type:varchar(255)"`
        CreatedAt         time.Time `gorm:"created_at"`
        CreatedBy         string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt         time.Time `gorm:"updated_at"`
        UpdatedBy         string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt         time.Time `gorm:"deleted_at"`
        DeletedBy         string    `gorm:"deleted_by;type:varchar(50)"`
}

type ProductQuery struct {
        ID                  string    `gorm:"id"`
        Code                string    `gorm:"code"`
        Name                string    `gorm:"name"`
        Price               int64     `gorm:"price"`
        ProductCategoryName string    `gorm:"product_category_name"`
        IsActive            bool      `gorm:"isactive"`
        UnitName            string    `gorm:"unitname"`
        Description         string    `gorm:"description"`
        Qty                 int       `gorm:"qty"`
        QtyCart             int       `gorm:"qty_cart"`
        CreatedAt           time.Time `gorm:"created_at"`
        CreatedBy           string    `gorm:"created_by"`
        UpdatedAt           time.Time `gorm:"updated_at"`
        UpdatedBy           string    `gorm:"updated_by"`
}

func (p *ProductQuery) ToProduct() product.Product <span class="cov0" title="0">{
        return product.Product{
                ID:                  p.ID,
                Code:                p.Code,
                Name:                p.Name,
                Price:               p.Price,
                IsActive:            p.IsActive,
                UnitName:            p.UnitName,
                Description:         p.Description,
                ProductCategoryName: p.ProductCategoryName,
                Qty:                 int32(p.Qty),
                QtyCart:             int32(p.QtyCart),
                CreatedAt:           p.CreatedAt,
                CreatedBy:           p.CreatedBy,
                UpdatedAt:           p.UpdatedAt,
                UpdatedBy:           p.UpdatedBy,
        }
}</span>

func (p *Product) ToProduct() product.Product <span class="cov0" title="0">{
        return product.Product{
                ID:                p.ID,
                Code:              p.Code,
                Name:              p.Name,
                Price:             p.Price,
                IsActive:          p.IsActive,
                ProductCategoryId: p.ProductCategoryId,
                UnitName:          p.UnitName,
                Description:       p.Description,
                CreatedAt:         p.CreatedAt,
                CreatedBy:         p.CreatedBy,
                UpdatedAt:         p.UpdatedAt,
                UpdatedBy:         p.UpdatedBy,
                DeletedAt:         p.DeletedAt,
                DeletedBy:         p.DeletedBy,
        }
}</span>

func newDataProduct(p product.Product) *Product <span class="cov0" title="0">{
        return &amp;Product{
                ID:                p.ID,
                Code:              p.Code,
                Name:              p.Name,
                Price:             p.Price,
                IsActive:          p.IsActive,
                ProductCategoryId: p.ProductCategoryId,
                UnitName:          p.UnitName,
                Description:       p.Description,
                CreatedAt:         p.CreatedAt,
                CreatedBy:         p.CreatedBy,
                UpdatedAt:         p.CreatedAt,
                UpdatedBy:         p.CreatedBy,
                DeletedAt:         p.DeletedAt,
                DeletedBy:         p.DeletedBy,
        }
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) GetAllProduct() (*[]product.Product, error) <span class="cov0" title="0">{
        var products []ProductQuery
        // var tempProduct product.Product

        // err := r.DB.Preload("ProductCategory").Where("deleted_by = ''").Find(&amp;products).Error
        var query = "select t1.*, stock_akhir qty, stock_cart qty_cart, t2.product_category_name from products t1" +
                " inner join product_stock(t1.id) on productid = t1.id " +
                " inner join product_categories t2 on t2.id = product_category_id " +
                " where deleted_by = ''"
        err := r.DB.Raw(query).Scan(&amp;products).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">var productOuts []product.Product
        for _, value := range products </span><span class="cov0" title="0">{
                // tempProduct = value.ToProduct()
                // tempProduct.ProductCategoryName = value.ProductCategory.Name
                // tempProduct.Qty = 10
                // tempProduct.QtyCart = 0
                productOuts = append(productOuts, value.ToProduct()) //tempProduct)
        }</span>

        <span class="cov0" title="0">return &amp;productOuts, nil</span>
}

func (r *Repository) GetAllProductByParameter(id, isActive, categoryName,
        code, name string) (*[]product.Product, error) <span class="cov0" title="0">{
        // var products []Product
        var products []ProductQuery
        // var tempProduct product.Product
        var productOuts []product.Product

        var query = "select t1.*, stock_akhir qty, stock_cart qty_cart, t2.name product_category_name from products t1" +
                " inner join product_stock(t1.id) on productid = t1.id " +
                " inner join product_categories t2 on t2.id = product_category_id " +
                " where t1.deleted_by = ''"

        // temp := r.DB
        // temp = temp.Preload("ProductCategory")
        if categoryName != "" </span><span class="cov0" title="0">{
                // temp = temp.Joins("inner join product_categories on product_categories.id = products.product_category_id")
                // temp = temp.Where("product_categories.name = ?", categoryName)
                query += fmt.Sprintf(" and t2.name = '%s'", categoryName)
        }</span>

        <span class="cov0" title="0">if id != "" </span><span class="cov0" title="0">{
                // temp = temp.Where("id = ?", id)
                query += fmt.Sprintf(" and t1.id = '%s'", id)
        }</span>
        <span class="cov0" title="0">if isActive != "" </span><span class="cov0" title="0">{
                res, err := strconv.ParseBool(isActive)
                if err != nil </span><span class="cov0" title="0">{
                        return &amp;productOuts, nil
                }</span>
                // temp = temp.Where("is_active = ?", res)
                <span class="cov0" title="0">query += fmt.Sprintf(" and t1.is_active = %t", res)</span>
        }
        <span class="cov0" title="0">if code != "" </span><span class="cov0" title="0">{
                // temp = temp.Where("code = ?", code)
                query += fmt.Sprintf(" and t1.code = '%s'", code)
        }</span>
        <span class="cov0" title="0">if name != "" </span><span class="cov0" title="0">{
                // temp = temp.Where("name = ?", name)
                query += fmt.Sprintf(" and t1.name = '%s'", name)
        }</span>

        // err := temp.Where("deleted_by = ''").Find(&amp;products).Error
        <span class="cov0" title="0">err := r.DB.Raw(query).Scan(&amp;products).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        // for _, value := range products {
        //         tempProduct = value.ToProduct()

        //         tempProduct.ProductCategoryName = value.ProductCategory.Name
        //         tempProduct.Qty = 10
        //         tempProduct.QtyCart = 0
        //         productOuts = append(productOuts, tempProduct)
        // }

        <span class="cov0" title="0">for _, value := range products </span><span class="cov0" title="0">{
                productOuts = append(productOuts, value.ToProduct())
        }</span>

        <span class="cov0" title="0">return &amp;productOuts, nil</span>
}

func (r *Repository) FindProductById(id string) (*product.Product, error) <span class="cov0" title="0">{
        var product *Product

        err := r.DB.Where("id = ?", id).Where("deleted_by = ''").First(&amp;product).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">response := product.ToProduct()
        return &amp;response, nil</span>
}

func (r *Repository) FindProductByCode(code string) (*product.Product, error) <span class="cov0" title="0">{
        var product *Product

        err := r.DB.Where("code = ?", code).Where("deleted_by = ''").First(&amp;product).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">response := product.ToProduct()
        return &amp;response, nil</span>
}

func (r *Repository) InsertProduct(p product.Product) error <span class="cov0" title="0">{
        product := newDataProduct(p)
        if err := r.DB.Create(product).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) UpdateProduct(p product.Product) error <span class="cov0" title="0">{
        product := newDataProduct(p)
        err := r.DB.Model(&amp;product).Updates(Product{
                Name:              product.Name,
                Price:             product.Price,
                IsActive:          product.IsActive,
                ProductCategoryId: product.ProductCategoryId,
                UnitName:          product.UnitName,
                Description:       product.Description,
                UpdatedAt:         product.UpdatedAt,
                UpdatedBy:         product.UpdatedBy,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) DeleteProduct(p product.Product) error <span class="cov0" title="0">{
        product := newDataProduct(p)

        err := r.DB.Model(&amp;product).Updates(Product{
                DeletedBy: product.DeletedBy,
                DeletedAt: product.DeletedAt,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}
</pre>
		
		<pre class="file" id="file91" style="display: none">package purchasereceiving

import (
        "AltaStore/business/purchasereceiving"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type PurchaseReceiving struct {
        ID           string    `gorm:"id;type:uuid;primaryKey"`
        Code         string    `gorm:"code;type:varchar(50);unique"`
        DateReceived time.Time `gorm:"datereceived;type:timestamp"`
        ReceivedBy   string    `gorm:"receivedby;type:varchar(50)"`
        Description  string    `gorm:"description;type:varchar(100)"`
        CreatedAt    time.Time `gorm:"created_at"`
        CreatedBy    string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt    time.Time `gorm:"updated_at"`
        UpdatedBy    string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt    time.Time `gorm:"deleted_at"`
        DeletedBy    string    `gorm:"deleted_by;type:varchar(50)"`
}

func (p *PurchaseReceiving) toPurchaseReceiving() *purchasereceiving.PurchaseReceiving <span class="cov0" title="0">{
        return &amp;purchasereceiving.PurchaseReceiving{
                ID:           p.ID,
                Code:         p.Code,
                DateReceived: p.DateReceived,
                ReceivedBy:   p.ReceivedBy,
                Description:  p.Description,
                CreatedAt:    p.CreatedAt,
                CreatedBy:    p.CreatedBy,
                UpdatedBy:    p.UpdatedBy,
                UpdatedAt:    p.UpdatedAt,
                DeletedBy:    p.DeletedBy,
                DeletedAt:    p.DeletedAt,
        }
}</span>

func newPurchaseReceiving(
        p *purchasereceiving.PurchaseReceiving,
) *PurchaseReceiving <span class="cov0" title="0">{
        return &amp;PurchaseReceiving{
                ID:           p.ID,
                Code:         p.Code,
                DateReceived: p.DateReceived,
                ReceivedBy:   p.ReceivedBy,
                Description:  p.Description,
                CreatedAt:    p.CreatedAt,
                CreatedBy:    p.CreatedBy,
                UpdatedAt:    p.UpdatedAt,
                UpdatedBy:    p.UpdatedBy,
                DeletedAt:    p.DeletedAt,
                DeletedBy:    p.DeletedBy,
        }
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) InsertPurchaseReceiving(p *purchasereceiving.PurchaseReceiving) error <span class="cov0" title="0">{
        purchase := newPurchaseReceiving(p)
        if err := r.DB.Create(purchase).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) UpdatePurchaseReceiving(p *purchasereceiving.PurchaseReceiving) error <span class="cov0" title="0">{
        purchase := newPurchaseReceiving(p)
        err := r.DB.Model(&amp;purchase).Updates(PurchaseReceiving{
                DateReceived: purchase.DateReceived,
                ReceivedBy:   purchase.ReceivedBy,
                Description:  purchase.Description,
                UpdatedAt:    purchase.UpdatedAt,
                UpdatedBy:    purchase.UpdatedBy,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) DeletePurchaseReceiving(p *purchasereceiving.PurchaseReceiving) error <span class="cov0" title="0">{
        purchase := newPurchaseReceiving(p)

        err := r.DB.Model(&amp;purchase).Updates(PurchaseReceiving{
                DeletedBy: purchase.DeletedBy,
                DeletedAt: purchase.DeletedAt,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) GetAllPurchaseReceivingByParameter(code string) (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        var purchases []PurchaseReceiving
        var tempPurchase purchasereceiving.PurchaseReceiving
        var purchasetOuts []purchasereceiving.PurchaseReceiving

        temp := r.DB
        if code != "" </span><span class="cov0" title="0">{
                temp = temp.Where("code = ?", code)
        }</span>
        <span class="cov0" title="0">err := temp.Where("deleted_by = ''").Find(&amp;purchases).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">for _, value := range purchases </span><span class="cov0" title="0">{
                tempPurchase = *value.toPurchaseReceiving()
                purchasetOuts = append(purchasetOuts, tempPurchase)
        }</span>

        <span class="cov0" title="0">return &amp;purchasetOuts, nil</span>
}
func (r *Repository) GetAllPurchaseReceiving() (*[]purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        var purchases []PurchaseReceiving
        var tempPurchase purchasereceiving.PurchaseReceiving
        var purchasetOuts []purchasereceiving.PurchaseReceiving

        temp := r.DB
        err := temp.Where("deleted_by = ''").Find(&amp;purchases).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">for _, value := range purchases </span><span class="cov0" title="0">{
                tempPurchase = *value.toPurchaseReceiving()
                purchasetOuts = append(purchasetOuts, tempPurchase)
        }</span>

        <span class="cov0" title="0">return &amp;purchasetOuts, nil</span>
}

func (r *Repository) GetPurchaseReceivingById(id string) (*purchasereceiving.PurchaseReceiving, error) <span class="cov0" title="0">{
        var purchase PurchaseReceiving

        err := r.DB.Where("id = ?", id).Where("deleted_by = ''").First(&amp;purchase).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return purchase.toPurchaseReceiving(), nil</span>
}
</pre>
		
		<pre class="file" id="file92" style="display: none">package purchasereceivingdetail

import (
        "AltaStore/business/purchasereceiving"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type PurchaseReceivingDetail struct {
        ID                  string    `gorm:"id;type:uuid;primaryKey"`
        PurchaseReceivingId string    `gorm:"purchase_receiving_id;type:varchar(50)"`
        ProductId           string    `gorm:"product_id;type:varchar(50)"`
        Price               int64     `gorm:"price;"`
        Qty                 int32     `gorm:"qty;"`
        CreatedAt           time.Time `gorm:"created_at"`
        CreatedBy           string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt           time.Time `gorm:"updated_at"`
        UpdatedBy           string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt           time.Time `gorm:"deleted_at"`
        DeletedBy           string    `gorm:"deleted_by;type:varchar(50)"`
}

func (p *PurchaseReceivingDetail) toPurchaseReceivingDetail() *purchasereceiving.PurchaseReceivingDetail <span class="cov0" title="0">{
        return &amp;purchasereceiving.PurchaseReceivingDetail{
                ID:        p.ID,
                ProductId: p.ProductId,
                Price:     p.Price,
                Qty:       p.Qty,
                CreatedBy: p.CreatedBy,
                CreatedAt: p.CreatedAt,
                UpdatedBy: p.UpdatedBy,
                UpdatedAt: p.UpdatedAt,
                DeletedBy: p.DeletedBy,
                DeletedAt: p.DeletedAt,
        }
}</span>

func newDataPurchaseReceivingDetail(
        p *purchasereceiving.PurchaseReceivingDetail,
) *PurchaseReceivingDetail <span class="cov0" title="0">{
        return &amp;PurchaseReceivingDetail{
                ID:                  p.ID,
                PurchaseReceivingId: p.PurchaseReceivingId,
                ProductId:           p.ProductId,
                Price:               p.Price,
                Qty:                 p.Qty,
                CreatedBy:           p.CreatedBy,
                CreatedAt:           p.CreatedAt,
                UpdatedBy:           p.UpdatedBy,
                UpdatedAt:           p.UpdatedAt,
                DeletedBy:           p.DeletedBy,
                DeletedAt:           p.DeletedAt,
        }
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) InsertPurchaseReceivingDetail(p *purchasereceiving.PurchaseReceivingDetail) error <span class="cov0" title="0">{
        detail := newDataPurchaseReceivingDetail(p)
        if err := r.DB.Create(detail).Error; err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) UpdatePurchaseReceivingDetail(p *purchasereceiving.PurchaseReceivingDetail) error <span class="cov0" title="0">{
        detail := newDataPurchaseReceivingDetail(p)
        err := r.DB.Model(&amp;detail).Updates(PurchaseReceivingDetail{
                ProductId: detail.ProductId,
                Price:     detail.Price,
                Qty:       detail.Qty,
                UpdatedAt: detail.UpdatedAt,
                UpdatedBy: detail.UpdatedBy,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) DeletePurchaseReceivingDetail(p *purchasereceiving.PurchaseReceivingDetail) error <span class="cov0" title="0">{
        detail := newDataPurchaseReceivingDetail(p)

        err := r.DB.Model(&amp;detail).Updates(PurchaseReceivingDetail{
                DeletedBy: detail.DeletedBy,
                DeletedAt: detail.DeletedAt,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) GetPurchaseReceivingDetailByPurchaseReceivingId(id string) (*[]purchasereceiving.PurchaseReceivingDetail, error) <span class="cov0" title="0">{
        var details []PurchaseReceivingDetail
        var tempDetail purchasereceiving.PurchaseReceivingDetail
        var detailsOuts []purchasereceiving.PurchaseReceivingDetail

        err := r.DB.Where("purchase_receiving_id = ?", id).Where("deleted_by = ''").Order("created_at asc").Order("updated_at asc").Find(&amp;details).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">for _, value := range details </span><span class="cov0" title="0">{
                tempDetail = *value.toPurchaseReceivingDetail()
                detailsOuts = append(detailsOuts, tempDetail)
        }</span>

        <span class="cov0" title="0">return &amp;detailsOuts, nil</span>
}

func (r *Repository) GetPurchaseReceivingDetailById(id string) (*purchasereceiving.PurchaseReceivingDetail, error) <span class="cov0" title="0">{
        var detail purchasereceiving.PurchaseReceivingDetail

        err := r.DB.Where("deleted_by = ''").Where("id = ?", id).First(&amp;detail).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return &amp;detail, nil</span>
}
</pre>
		
		<pre class="file" id="file93" style="display: none">package shopping

import (
        "AltaStore/business"
        "AltaStore/business/shopping"
        "errors"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type ShoppingCart struct {
        ID          string    `gorm:"id;type:uuid;primaryKey"`
        IsCheckOut  bool      `gorm:"is_check_out;type:boolean;default:false"`
        Description string    `gorm:"description;type:varchar(100)"`
        CreatedBy   string    `gorm:"created_by;type:uuid"`
        CreatedAt   time.Time `gorm:"created_at;type:timestamp"`
        UpdatedAt   time.Time `gorm:"updated_at;type:timestamp"`
        DeletedAt   time.Time `gorm:"deleted_at;type:timestamp"`
}

func (s *ShoppingCart) toShoppCart() *shopping.ShoppCart <span class="cov0" title="0">{
        return &amp;shopping.ShoppCart{
                ID:          s.ID,
                IsCheckOut:  s.IsCheckOut,
                Description: s.Description,
                CreatedBy:   s.CreatedBy,
                CreatedAt:   s.CreatedAt,
                UpdatedAt:   s.UpdatedAt,
        }
}</span>

func (s *ShoppingCart) newShoppingCart(id string, userid string, description string, createdAt time.Time) <span class="cov0" title="0">{
        s.ID = id
        s.IsCheckOut = false
        s.Description = description
        s.CreatedBy = userid
        s.CreatedAt = createdAt
        s.UpdatedAt = createdAt
}</span>

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

func (r *Repository) GetShoppingCartByUserId(userid string) (*shopping.ShoppCart, error) <span class="cov0" title="0">{
        var shopCart ShoppingCart

        err := r.DB.First(&amp;shopCart, "is_check_out = false and created_by = ?", userid).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return shopCart.toShoppCart(), nil</span>
}

func (r *Repository) GetShoppingCartById(id string) (*shopping.ShoppCart, error) <span class="cov0" title="0">{
        var shopCart ShoppingCart

        err := r.DB.First(&amp;shopCart, "is_check_out = false and id = ?", id).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return shopCart.toShoppCart(), nil</span>
}

func (r *Repository) NewShoppingCart(id string, userid string, description string, createdAt time.Time) (*shopping.ShoppCart, error) <span class="cov0" title="0">{
        var shopCart ShoppingCart

        err := r.DB.First(&amp;shopCart, "is_check_out = false and created_by = ?", userid).Error

        // Pengecekan jika masih terdapat keranjang aktif maka dikembalikan bad request
        if !errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov0" title="0">{
                return nil, business.ErrHasBeenModified
        }</span>

        <span class="cov0" title="0">shopCart.newShoppingCart(id, userid, description, createdAt)

        if err := r.DB.Create(&amp;shopCart).Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return shopCart.toShoppCart(), nil</span>
}
</pre>
		
		<pre class="file" id="file94" style="display: none">package shoppingdetail

import (
        "AltaStore/modules/product"
        "time"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

type ShoppingCartDetail struct {
        ID             string          `gorm:"id;type:uuid;primaryKey"`
        ShoppingCartId string          `gorm:"shopping_cart_id;type:uuid;index:shopping_detail_uniq"`
        ProductId      string          `gorm:"product_id;type:uuid;index:shopping_detail_uniq"`
        Product        product.Product `gorm:"foreignKey:ProductId"`
        Price          int             `gorm:"price;type:integer"`
        Qty            int             `gorm:"qty;type:integer"`
        CreatedAt      time.Time       `gorm:"created_at;type:timestamp"`
        UpdatedAt      time.Time       `gorm:"updated_at;type:timestamp"`
        DeletedAt      time.Time       `gorm:"deleted_at;type:timestamp"`
}

type ShopCartDetailItemWithProductName struct {
        ShoppingCartDetail
        ProductName string `gorm:"name"`
}

type InsertItemInCartSpec struct {
        ID        string
        ProductId string
        Price     int
        Qty       int
        CreatedAt time.Time
        UpdatedAt time.Time
}

type UpdateItemInCartSpec struct {
        ID        string
        ProductId string
        Price     int
        Qty       int
        UpdatedAt time.Time
}

func createItemInCart(cartId string, item *InsertItemInCartSpec) *ShoppingCartDetail <span class="cov0" title="0">{
        return &amp;ShoppingCartDetail{
                ID:             item.ID,
                ShoppingCartId: cartId,
                ProductId:      item.ProductId,
                Price:          item.Price,
                Qty:            item.Qty,
                CreatedAt:      item.CreatedAt,
                UpdatedAt:      item.UpdatedAt,
        }
}</span>

func modifyItemInCart(item *UpdateItemInCartSpec) *ShoppingCartDetail <span class="cov0" title="0">{
        return &amp;ShoppingCartDetail{
                Price:     item.Price,
                Qty:       item.Qty,
                UpdatedAt: item.UpdatedAt,
        }
}</span>

func (r *Repository) GetShopCartDetailById(id string) (*[]ShopCartDetailItemWithProductName, error) <span class="cov0" title="0">{
        var shopCartDetail []ShopCartDetailItemWithProductName

        err := r.DB.Raw("select t1.*, t2.name product_name from shopping_cart_details t1 inner join products t2 on t2.id = t1.product_id where t1.shopping_cart_id = ?", id).Scan(&amp;shopCartDetail).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return &amp;shopCartDetail, nil</span>
}

func (r *Repository) NewItemInShopCart(cartId string, item *InsertItemInCartSpec) error <span class="cov0" title="0">{
        err := r.DB.Create(createItemInCart(cartId, item)).Error

        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (r *Repository) ModifyItemInShopCart(cartId string, productid string, item *UpdateItemInCartSpec) error <span class="cov0" title="0">{
        var itemInCart ShoppingCartDetail

        err := r.DB.Where("shopping_cart_id = ? and product_id = ?", cartId, productid).Find(&amp;itemInCart).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">r.DB.Model(&amp;itemInCart).Updates(modifyItemInCart(item))

        return nil</span>
}

func (r *Repository) DeleteItemInShopCart(cartId string, productid string) error <span class="cov0" title="0">{
        var itemInCart ShoppingCartDetail

        err := r.DB.Where("shopping_cart_id = ? and product_id = ?", cartId, productid).Find(&amp;itemInCart).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">r.DB.Delete(&amp;itemInCart)
        return nil</span>
}

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>
</pre>
		
		<pre class="file" id="file95" style="display: none">package user

import (
        "AltaStore/business/user"

        "time"

        "golang.org/x/crypto/bcrypt"
        "gorm.io/gorm"
)

// Implementasi repositori user
type Repository struct {
        DB *gorm.DB
}

type User struct {
        ID        string    `gorm:"type:uuid;primary_key"`
        Email     string    `gorm:"email;index:idx_email,unique;type:varchar(50)"`
        FirstName string    `gorm:"firstname;type:varchar(50)"`
        LastName  string    `gorm:"lastname;type:varchar(50)"`
        Password  string    `gorm:"password;type:varchar(100)"`
        HandPhone string    `gorm:"handphone;type:varchar(50)"`
        Address   string    `gorm:"address;type:varchar(100)"`
        CreatedAt time.Time `gorm:"created_at"`
        CreatedBy string    `gorm:"created_by;type:varchar(50)"`
        UpdatedAt time.Time `gorm:"updated_at"`
        UpdatedBy string    `gorm:"updated_by;type:varchar(50)"`
        DeletedAt time.Time `gorm:"deleted_at"`
        DeletedBy string    `gorm:"deleted_by;type:varchar(50)"`
}

func newUserTable(user user.User) *User <span class="cov0" title="0">{

        return &amp;User{
                user.ID,
                user.Email,
                user.FirstName,
                user.LastName,
                user.Password,
                user.HandPhone,
                user.Address,
                user.CreatedAt,
                user.CreatedBy,
                user.UpdatedAt,
                user.UpdatedBy,
                user.DeletedAt,
                user.DeletedBy,
        }
}</span>

func (col *User) ToUser() user.User <span class="cov0" title="0">{
        var user user.User

        user.ID = col.ID
        user.Email = col.Email
        user.FirstName = col.FirstName
        user.LastName = col.LastName
        user.HandPhone = col.HandPhone
        user.Address = col.Address
        user.CreatedAt = col.CreatedAt
        user.CreatedBy = col.CreatedBy
        user.UpdatedAt = col.UpdatedAt
        user.UpdatedBy = col.UpdatedBy
        user.DeletedAt = col.DeletedAt
        user.DeletedBy = col.DeletedBy

        return user
}</span>

// Menghasilkan ORM DB untuk user repository
func NewDBRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{db}
}</span>

//InsertUser Insert new User into storage
func (repo *Repository) InsertUser(user user.User) error <span class="cov0" title="0">{

        userData := newUserTable(user)

        err := repo.DB.Create(userData).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//FindUserByEmailAndPassword If data not found will return nil
func (repo *Repository) FindUserByEmailAndPassword(email string, password string) (*user.User, error) <span class="cov0" title="0">{

        var userData User

        err := repo.DB.Where("email = ?", email).Where("deleted_by = ''").First(&amp;userData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        // Comparing the password with the hash
        <span class="cov0" title="0">err = bcrypt.CompareHashAndPassword([]byte(userData.Password), []byte(password))
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">user := userData.ToUser()

        return &amp;user, nil</span>
}

func (repo *Repository) FindUserByEmail(email string) (*user.User, error) <span class="cov0" title="0">{

        var userData User

        err := repo.DB.Where("email = ?", email).Where("deleted_by = ''").First(&amp;userData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">user := userData.ToUser()

        return &amp;user, nil</span>
}

//FindUserByID If data not found will return nil without error
func (repo *Repository) FindUserByID(id string) (*user.User, error) <span class="cov0" title="0">{

        var userData User

        err := repo.DB.Where("id = ?", id).Where("deleted_by = ''").First(&amp;userData).Error
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">user := userData.ToUser()

        return &amp;user, nil</span>
}

//UpdateUserPassword if data not found or old password wrong will return error
func (repo *Repository) UpdateUserPassword(user user.User) error <span class="cov0" title="0">{
        userData := newUserTable(user)

        err := repo.DB.Model(&amp;userData).Updates(User{
                Password: userData.Password,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//UpdateUser Update existing user in database
func (repo *Repository) UpdateUser(user user.User) error <span class="cov0" title="0">{
        userData := newUserTable(user)

        err := repo.DB.Model(&amp;userData).Updates(User{
                FirstName: userData.FirstName,
                LastName:  userData.LastName,
                Address:   userData.Address,
                Password:  userData.Password,
                HandPhone: userData.HandPhone,
                UpdatedAt: userData.UpdatedAt,
                UpdatedBy: userData.UpdatedBy,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}

//DeleteUser Set IsDelete true in database
func (repo *Repository) DeleteUser(user user.User) error <span class="cov0" title="0">{
        userData := newUserTable(user)

        err := repo.DB.Model(&amp;userData).Updates(User{
                DeletedBy: userData.DeletedBy,
                DeletedAt: userData.DeletedAt,
        }).Error
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">return nil</span>
}
</pre>
		
		<pre class="file" id="file96" style="display: none">package validator

import (
        "sync"

        "github.com/go-playground/validator/v10"
)

var lock = &amp;sync.Mutex{}
var validate *validator.Validate

//GetValidator Initiatilize validator in singleton way
func GetValidator() *validator.Validate <span class="cov8" title="1">{
        lock.Lock()
        defer lock.Unlock()

        if validate == nil </span><span class="cov8" title="1">{
                validate = validator.New()
        }</span>

        <span class="cov8" title="1">return validate</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
